import{o as q,s as A,h as K,a as F}from"./schemas-DYlokDEL.js";import"./index-BGeuzjgU.js";import{r as u,X as H,J as Q,c as y,o as c,a as o,e as $,j as _,w as i,b as e,L as l,y as I,A as W,F as Y,M as N,P as d,n as Z}from"./index-Svb1OpEq.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as M,a as ee,b as P}from"./index-BVU6jy5i.js";import{b as S}from"./index-wEXAf2Hi.js";import{a as X}from"./index-BHX5PEbn.js";import{s as L}from"./index-CkAboL5O.js";import{s as z}from"./index-SePvlrEV.js";import{s as G}from"./index-CEPSfEdT.js";import{r as se,u as te,s as le,a as ae,b as j,c as oe,d as J}from"./xlsx-B6oGC_g7.js";import{d as ie}from"./helpers-DnWjwZ6V.js";import"./index-BdDubOrK.js";import"./index-C7UvTH9h.js";import"./index-CQkKTO2W.js";const ne={class:"flex items-center gap-8 py-4"},re={class:"flex items-center gap-1"},de={class:"flex items-center gap-1"},ce={class:"flex flex-col gap-1 col-span-1"},ue={class:"flex flex-col gap-1 col-span-1"},pe={class:"flex flex-col gap-1 col-span-1"},me={class:"flex flex-col gap-1 col-span-3"},ve={class:"flex flex-col gap-1 col-span-1"},fe={class:"flex flex-col gap-1 col-span-1"},he={class:"flex flex-col gap-1 col-span-3"},xe={class:"flex items-center text-sm"},ge={class:"capitalize"},ye={class:"flex items-center text-sm mt-2"},_e={class:"capitalize"},be={class:"flex items-center text-sm"},we={__name:"AddressConvert",setup(U){const p=u([]),m=u([]),f=u([]),h=u("oldToNew"),b=u(!1),v=u(!1),w=u(null),g=u(null),V=()=>{w.value=null,g.value=null,v.value=!1},R=async()=>{try{const n=await N.get("/connector/viettelpost/provinces");n.data.success?p.value=n.data.data.data:d.error(n.data.message||"Lỗi khi lấy tỉnh/thành phố")}catch(n){d.error("Lỗi khi lấy tỉnh/thành phố"),console.error(n)}},D=async n=>{V();const s=p.value.find(t=>t.PROVINCE_NAME===n)?.PROVINCE_ID;if(!s){d.error("Không tìm thấy Id tỉnh");return}try{const t=await N.get("/connector/viettelpost/districts",{params:{provinceId:s}});t.data.success?m.value=t.data.data.data:d.error(t.data.message||"Lỗi khi lấy quận/huyện")}catch(t){d.error("Lỗi khi lấy quận/huyện"),console.error(t)}},O=async n=>{V();const s=m.value.find(t=>t.DISTRICT_NAME===n)?.DISTRICT_ID;if(!s){d.error("Không tìm thấy Id quận");return}try{const t=await N.get("/connector/viettelpost/wards",{params:{districtId:s}});t.data.success?f.value=t.data.data.data:d.error(t.data.message||"Lỗi khi lấy phường/xã")}catch(t){d.error("Lỗi khi lấy phường/xã"),console.error(t)}},x=async n=>{V();const s=p.value.find(t=>t.PROVINCE_NAME===n)?.PROVINCE_ID;if(!s){d.error("Không tìm thấy Id tỉnh");return}try{const t=await N.get("/connector/viettelpost/wards-new",{params:{provinceId:s}});t.data.success?f.value=t.data.data.data:d.error(t.data.message||"Lỗi khi lấy phường/xã")}catch(t){d.error("Lỗi khi lấy phường/xã"),console.error(t)}},a=q({province:A().min(1),district:A().min(1),ward:A().min(1),address:A().min(1)}),r=q({province:A().min(1),ward:A().min(1),address:A().min(1)}),T=H(()=>h.value==="oldToNew"?K(a):K(r)),C=async n=>{if(!n.valid){d.error("Vui lòng nhập đầy đủ thông tin");return}b.value=!0;let s="";h.value==="oldToNew"?s=`${n.values.address}, ${n.values.ward}, ${n.values.district}, ${n.values.province}`:s=`${n.values.address}, ${n.values.ward}, ${n.values.province}`;try{const t=await N.post("/connector/viettelpost/checking-address",{address:s});t.data.success&&(g.value=t.data.data.reference.formattedAddress,w.value=s),v.value=!0,b.value=!1}catch(t){console.error(t),b.value=!1,v.value=!0}};return Q(()=>{R()}),(n,s)=>(c(),y(Y,null,[o(l(z),{class:"w-full mt-4"},{content:i(()=>[e("div",null,[s[4]||(s[4]=e("h2",null,"Phương thức chuyển đổi",-1)),e("div",ne,[e("div",re,[o(l(M),{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=t=>h.value=t),value:"oldToNew",size:"small"},null,8,["modelValue"]),s[2]||(s[2]=e("label",{class:"text-sm font-medium"},"Cũ sang mới",-1))]),e("div",de,[o(l(M),{modelValue:h.value,"onUpdate:modelValue":s[1]||(s[1]=t=>h.value=t),value:"newToOld",size:"small"},null,8,["modelValue"]),s[3]||(s[3]=e("label",{class:"text-sm font-medium"},"Mới sang cũ",-1))])])]),h.value==="oldToNew"?(c(),$(l(F),{key:0,initialValues:{province:"",district:"",ward:"",address:""},resolver:T.value,onSubmit:C,class:"grid grid-cols-3 gap-x-2 gap-y-4"},{default:i(t=>[e("div",ce,[s[5]||(s[5]=e("label",{class:"text-sm font-medium"},"Tỉnh/Thành phố",-1)),o(l(S),{name:"province",onChange:k=>D(t.province.value),options:p.value,optionLabel:"PROVINCE_NAME",optionValue:"PROVINCE_NAME",size:"small"},null,8,["onChange","options"])]),e("div",ue,[s[6]||(s[6]=e("label",{class:"text-sm font-medium"},"Quận/Huyện",-1)),o(l(S),{name:"district",onChange:k=>O(t.district.value),options:m.value,optionLabel:"DISTRICT_NAME",optionValue:"DISTRICT_NAME",size:"small"},null,8,["onChange","options"])]),e("div",pe,[s[7]||(s[7]=e("label",{class:"text-sm font-medium"},"Phường/Xã",-1)),o(l(S),{name:"ward",options:f.value,optionLabel:"WARDS_NAME",optionValue:"WARDS_NAME",size:"small"},null,8,["options"])]),e("div",me,[s[8]||(s[8]=e("label",{class:"text-sm font-medium"},"Địa chỉ",-1)),o(l(X),{name:"address",size:"small"})]),o(l(L),{type:"submit",label:"Chuyển đổi",icon:"pi pi-check",loading:b.value,size:"small"},null,8,["loading"])]),_:1},8,["resolver"])):_("",!0),h.value==="newToOld"?(c(),$(l(F),{key:1,initialValues:{province:"",ward:"",address:""},resolver:T.value,onSubmit:C,class:"grid grid-cols-2 gap-x-2 gap-y-4"},{default:i(t=>[e("div",ve,[s[9]||(s[9]=e("label",{class:"text-sm font-medium"},"Tỉnh/Thành phố",-1)),o(l(S),{name:"province",onChange:k=>x(t.province.value),options:p.value,optionLabel:"PROVINCE_NAME",optionValue:"PROVINCE_NAME",size:"small"},null,8,["onChange","options"])]),e("div",fe,[s[10]||(s[10]=e("label",{class:"text-sm font-medium"},"Phường/Xã",-1)),o(l(S),{name:"ward",options:f.value,optionLabel:"WARDS_NAME",optionValue:"WARDS_NAME",size:"small"},null,8,["options"])]),e("div",he,[s[11]||(s[11]=e("label",{class:"text-sm font-medium"},"Địa chỉ",-1)),o(l(X),{name:"address",size:"small"})]),o(l(L),{type:"submit",label:"Chuyển đổi",icon:"pi pi-check",loading:b.value,size:"small"},null,8,["loading"])]),_:1},8,["resolver"])):_("",!0)]),_:1}),g.value&&v.value?(c(),$(l(z),{key:0,class:"mt-4 p-4 bg-green-200 result-card-success"},{header:i(()=>[...s[12]||(s[12]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-check-circle text-green-900"}),e("h2",{class:"text-green-900 font-bold text-xl"},"Kết quả")],-1)])]),content:i(()=>[e("div",xe,[s[13]||(s[13]=e("span",{class:"font-bold block w-32"},"Địa chỉ gốc:",-1)),e("span",ge,I(w.value),1)]),e("div",ye,[s[14]||(s[14]=e("span",{class:"font-bold block w-32"},"Địa chỉ chuyển đổi:",-1)),e("span",_e,I(g.value),1)])]),_:1})):_("",!0),!g.value&&v.value?(c(),$(l(z),{key:1,class:"mt-4 p-4 result-card-failure"},{header:i(()=>[...s[15]||(s[15]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-times-circle text-red-900"}),e("h2",{class:"text-red-900 font-bold text-xl"},"Kết quả")],-1)])]),content:i(()=>[e("div",be,[o(l(G),{severity:"error",icon:"pi pi-ban",size:"small"},{default:i(()=>[...s[16]||(s[16]=[W("Đã có lỗi xảy ra",-1)])]),_:1})])]),_:1})):_("",!0)],64))}},ke=B(we,[["__scopeId","data-v-19293057"]]),Ae={class:"flex items-center gap-8 py-4"},Ve={class:"flex items-center gap-1"},Ce={class:"flex items-center gap-1"},Ne={key:0},$e={class:"flex items-end gap-1 w-full"},Ie={class:"flex flex-col gap-1 flex-1"},ze={class:"flex items-center text-sm mt-2"},Te={class:"capitalize"},Ee={class:"flex items-center text-sm"},Se={key:1},Le={class:"flex items-center gap-4"},Me={key:0,class:"mt-4"},Re={class:"flex items-center gap-1 p-1 text-sm"},De={class:"text-sm"},Oe={key:0},Pe={key:0,class:"pi pi-times text-red-500 mr-2 mt-1",size:"small"},qe={key:1,class:"pi pi-check-circle text-green-700 mr-2 mt-1",size:"small"},Ke={key:1},Fe={class:"py-4 flex justify-end items-center"},We={__name:"AddressVerify",setup(U){const p=u(!1),m=K(q({address:A().min(1)})),f=u("single"),h=u(null),b=u(""),v=u(null),w=u([]),g=u(null),V=u(!1),R=async x=>{if(!x.valid){d.error("Vui lòng nhập đầy đủ thông tin");return}p.value=!0;try{const a=await N.post("/connector/viettelpost/checking-address",{address:x.values.address});a.data.success?(g.value=a.data.data?.formattedAddress,V.value=!0):d.error(a.data.message||"Địa chỉ không hợp lệ")}catch(a){d.error("Địa chỉ không hợp lệ"),console.error(a)}finally{p.value=!1}},D=x=>{if(v.value=x.target.files[0],b.value=x.target.files[0].name,!v.value)return;const a=new FileReader;a.onload=r=>{const T=new Uint8Array(r.target.result),C=se(T,{type:"array"}),n=C.SheetNames[0],s=C.Sheets[n];te.sheet_to_json(s).map((k,E)=>{k.address&&w.value.push({index:E+1,address:k.address,verifiedAddress:""})})},a.readAsArrayBuffer(v.value)},O=async()=>{if(!v.value){d.error("Vui lòng chọn file");return}p.value=!0;const x=2,a=ie(w.value,x);for(let r=0;r<a.length;r++){const C=a[r].map((s,t)=>{const k=r*x+t;return N.post("/connector/viettelpost/checking-address",{address:s.address}).then(E=>({idx:k,res:E})).catch(E=>{throw{idx:k,err:E}})});(await Promise.allSettled(C)).forEach(s=>{s.status==="fulfilled"?w.value[s.value.idx].verifiedAddress=s.value.res.data?.data?.formattedAddress||"Lỗi":console.log(s.value)})}p.value=!1};return(x,a)=>(c(),$(l(z),{class:"w-full mt-4"},{content:i(()=>[e("div",Ae,[e("div",Ve,[o(l(M),{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=r=>f.value=r),value:"single",size:"small"},null,8,["modelValue"]),a[3]||(a[3]=e("label",{for:"",class:"text-sm text-color font-medium"},"Địa chỉ đơn lẻ",-1))]),e("div",Ce,[o(l(M),{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=r=>f.value=r),value:"batch",size:"small"},null,8,["modelValue"]),a[4]||(a[4]=e("label",{for:"",class:"text-sm text-color font-medium"},"Địa chỉ hàng loạt",-1))])]),f.value==="single"?(c(),y("div",Ne,[o(l(F),{initialValues:{address:""},resolver:l(m),onSubmit:R},{default:i(r=>[e("div",$e,[e("div",Ie,[a[5]||(a[5]=e("label",{class:"text-sm font-medium"},"Địa chỉ",-1)),o(l(X),{name:"address",class:"w-full",size:"small"})]),o(l(L),{type:"submit",label:"Xác minh",icon:"pi pi-check",loading:p.value,size:"small"},null,8,["loading"])])]),_:1},8,["resolver"]),g.value&&V.value?(c(),$(l(z),{key:0,class:"mt-4 p-4 bg-green-200 result-card-success"},{header:i(()=>[...a[6]||(a[6]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-check-circle text-green-900"}),e("h2",{class:"text-green-900 font-bold text-xl"},"Kết quả")],-1)])]),content:i(()=>[e("div",ze,[e("span",Te,I(g.value),1)])]),_:1})):_("",!0),!g.value&&V.value?(c(),$(l(z),{key:1,class:"mt-4 p-4 result-card-failure"},{header:i(()=>[...a[7]||(a[7]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-times-circle text-red-900"}),e("h2",{class:"text-red-900 font-bold text-xl"},"Kết quả")],-1)])]),content:i(()=>[e("div",Ee,[o(l(G),{severity:"error",icon:"pi pi-ban",size:"small"},{default:i(()=>[...a[8]||(a[8]=[W("Đã có lỗi xảy ra",-1)])]),_:1})])]),_:1})):_("",!0)])):_("",!0),f.value==="batch"?(c(),y("div",Se,[e("div",Le,[e("input",{ref_key:"fileChooser",ref:h,type:"file",name:"file",id:"fileChooser",hidden:"",onChange:D},null,544),o(l(L),{type:"button",label:"Chọn file",size:"small",icon:"pi pi-upload",onClick:a[2]||(a[2]=r=>h.value.click())})]),v.value?(c(),y("div",Me,[e("span",Re,[a[9]||(a[9]=e("i",{class:"pi pi-file text-primary"},null,-1)),W(I(b.value),1)]),o(l(ee),{value:w.value,responsiveLayout:"scroll",showGridlines:""},{default:i(()=>[o(l(P),{field:"index",header:"STT",style:{"text-align":"center",padding:"1rem"}}),o(l(P),{field:"address",header:"Địa chỉ",style:{width:"50%",padding:"1rem"}},{body:i(r=>[e("span",De,I(r.data.address),1)]),_:1}),o(l(P),{field:"verifiedAddress",header:"Địa chỉ đã xác minh",style:{width:"50%",padding:"1rem"}},{body:i(r=>[r.data.verifiedAddress.length?(c(),y("div",Oe,[r.data.verifiedAddress==="Lỗi"?(c(),y("i",Pe)):(c(),y("i",qe)),e("span",{class:Z(["text-sm text-color",[r.data.verifiedAddress==="Lỗi"?"text-red-500":"text-green-700"]])},I(r.data.verifiedAddress),3)])):(c(),y("div",Ke))]),_:1})]),_:1},8,["value"]),e("div",Fe,[o(l(L),{onClick:O,type:"button",label:"Xác minh",icon:"pi pi-check",loading:p.value,size:"small"},null,8,["loading"])])])):_("",!0)])):_("",!0)]),_:1}))}},Xe=B(We,[["__scopeId","data-v-49d3460c"]]),Be={class:"h-full p-4 flex flex-col gap-2 overflow-auto"},Ue={__name:"index",setup(U){return(p,m)=>(c(),y("div",Be,[m[2]||(m[2]=e("div",{class:"flex flex-col gap-2"},[e("h1",{class:"text-2xl font-bold text-color"},"Tiện ích địa chỉ"),e("span",{class:"text-muted-color text-sm"},"Chuyển đổi và xác minh địa chỉ")],-1)),o(l(le),{value:"1",class:"flex flex-1 my-tab"},{default:i(()=>[o(l(ae),null,{default:i(()=>[o(l(j),{value:"1"},{default:i(()=>[...m[0]||(m[0]=[e("div",{class:"flex item-center gap-2"},[e("i",{class:"pi pi-arrow-right-arrow-left mt-1"}),e("span",{class:"text-sm"},"Chuyển đổi địa chỉ")],-1)])]),_:1}),o(l(j),{value:"2"},{default:i(()=>[...m[1]||(m[1]=[e("div",{class:"flex item-center gap-2"},[e("i",{class:"pi pi-map-marker mt-1"}),e("span",{class:"text-sm"},"Xác minh địa chỉ")],-1)])]),_:1})]),_:1}),o(l(oe),{class:"flex flex-1"},{default:i(()=>[o(l(J),{value:"1",class:"w-full"},{default:i(()=>[o(ke)]),_:1}),o(l(J),{value:"2",class:"w-full"},{default:i(()=>[o(Xe)]),_:1})]),_:1})]),_:1})]))}},rs=B(Ue,[["__scopeId","data-v-ba136978"]]);export{rs as default};
