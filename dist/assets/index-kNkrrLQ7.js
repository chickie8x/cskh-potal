import{h as Ve,o as ye,n as oe,s as g,a as be}from"./schemas-H1Qhvfz4.js";import"./index--oCpQVXH.js";import{B as Ue,R as he,c as I,o as E,k as Ae,m as Se,r as c,U as le,P as Ie,V as Ne,X as Te,J as He,a as s,w as i,b as l,L as t,j as F,F as ie,q as Ce,y as h,M as j,N as b,e as y,n as Le,p as we,A as De}from"./index-BoRylNbp.js";import{f as te,c as Me,d as ge}from"./helpers-YASWeJ1Q.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as $}from"./index-BkDVOZOa.js";import{e as ze,c as q,d as K,a as M}from"./index-B3hiadze.js";import{b as G}from"./index-CWSAp-GW.js";import{s as k}from"./index-ByC9cTlx.js";import{c as ee,a as ke,b as J}from"./index-D1tQ3NJu.js";import{s as x}from"./index-v9n35QsG.js";import{s as U}from"./index-DA-8dCNV.js";import{s as Ye}from"./index-Dg2TOw1s.js";import{s as $e}from"./index-DWUJkzp1.js";import{s as Ge}from"./index-CPWdx_K-.js";import{r as We,u as Fe,s as je,a as Be,b as Oe,c as Qe,d as xe}from"./xlsx-D9TdDIsU.js";import"./index-DnF_xtfv.js";import"./index-BQABsrsE.js";var Je=`
    .p-radiobutton-group {
        display: inline-flex;
    }
`,qe={root:"p-radiobutton-group p-component"},Ke=Ue.extend({name:"radiobuttongroup",style:Je,classes:qe}),Xe={name:"BaseRadioButtonGroup",extends:ze,style:Ke,provide:function(){return{$pcRadioButtonGroup:this,$parentInstance:this}}},re={name:"RadioButtonGroup",extends:Xe,inheritAttrs:!1,data:function(){return{groupName:this.name}},watch:{name:function(A){this.groupName=A||he("radiobutton-group-")}},mounted:function(){this.groupName=this.groupName||he("radiobutton-group-")}};function Ze(O,A,R,z,_,S){return E(),I("div",Se({class:O.cx("root")},O.ptmi("root")),[Ae(O.$slots,"default")],16)}re.render=Ze;const el={__name:"index",props:{form:Object},emits:["allFieldsHaveValue"],setup(O,{emit:A}){const R=O,z=A,_=["SENDER_ADDRESS","SENDER_FULLNAME","SENDER_PHONE","RECEIVER_FULLNAME","RECEIVER_PHONE","RECEIVER_PROVINCE","RECEIVER_DISTRICT","RECEIVER_WARD","RECEIVER_ADDR","PRODUCT_TYPE","PRODUCT_WEIGHT"],S=["SENDER_ADDRESS","PRODUCT_TYPE","PRODUCT_PRICE","PRODUCT_WEIGHT","PRODUCT_LENGTH","PRODUCT_WIDTH","PRODUCT_HEIGHT","TYPE","MONEY_COLLECTION"],H=c({});le(()=>_.map(m=>R.form[m]?.value),m=>{m.every(P=>P&&P!=="")&&N()},{deep:!0});function N(){S.map(p=>{H.value[p]=R.form[p]?.value});const m=`${R.form.RECEIVER_ADDR?.value}, ${R.form.RECEIVER_WARD?.value}, ${R.form.RECEIVER_DISTRICT?.value}, ${R.form.RECEIVER_PROVINCE?.value}`;H.value.RECEIVER_ADDRESS=m,H.value.TYPE=1,z("allFieldsHaveValue",H.value)}return(m,p)=>null}},ll={class:"flex gap-8 pb-4"},tl={class:"flex flex-col gap-4 w-3/5"},sl={class:"flex flex-col gap-4"},al={class:"flex flex-col gap-4"},nl={class:"flex items-center gap-2"},ol={class:"flex items-center gap-2"},il={class:"grid grid-cols-3 gap-8 text-sm text-color"},rl=["for"],ul={key:0,class:"mt-4 border-t border-surface flex items-center gap-12 pt-4 text-sm text-color"},dl={class:"flex items-center gap-2"},cl={class:"font-bold text-red-500"},ml={class:"flex items-center gap-2"},El={class:"font-bold text-red-500"},pl={class:"flex items-center gap-2"},_l={class:"font-bold text-red-500"},vl={class:"flex flex-col gap-4 w-2/5"},Rl={class:"flex flex-col gap-3"},fl={class:"flex flex-col gap-2 mt-4"},Tl={class:"flex items-center gap-2"},Cl={class:"flex items-center gap-2"},hl={class:"mt-2 border-t border-surface py-4 flex flex-col divide-y divide-dashed divide-surface-300"},Dl={class:"flex items-center gap-4"},gl={class:"flex items-center gap-2 mt-4"},Ol={class:"flex items-center justify-end py-4"},xl={class:"py-4 flex flex-col gap-2"},Il={class:"grid grid-cols-3 gap-2"},Nl={class:"mt-4 border-t border-surface py-4"},Pl={class:"flex items-center justify-between"},Vl={class:"text-sm font-semibold text-red-600"},yl={class:"flex items-center justify-between"},bl={class:"text-sm font-semibold text-red-600"},Ul={class:"flex items-center gap-2"},Al={class:"flex flex-col gap-2 mt-4"},Sl={class:"flex items-center gap-1"},Hl={class:"flex items-center gap-1"},Ll={class:"mt-4"},wl={class:"grid grid-cols-4 gap-2 text-sm text-color"},Ml={class:"flex items-center gap-2"},zl={class:"font-bold text-red-500"},kl={class:"flex items-center gap-2"},Yl={class:"font-bold text-red-500"},$l={class:"flex items-center gap-2"},Gl={class:"font-bold text-red-500"},Wl={class:"flex items-center gap-2"},Fl={class:"flex items-center justify-between gap-2"},jl={__name:"SingleOrderCreate",setup(O){const A=Ie(),R=Ve(ye({SENDER_ADDRESS:g().min(1,"Địa chỉ người gửi là bắt buộc"),SENDER_FULLNAME:g().min(1,"Tên người gửi là bắt buộc"),SENDER_PHONE:g().min(1,"Số điện thoại người gửi là bắt buộc"),RECEIVER_FULLNAME:g().min(1,"Tên người nhận là bắt buộc"),RECEIVER_PHONE:g().min(1,"Số điện thoại người nhận là bắt buộc"),RECEIVER_ADDRESS:g().min(1,"Địa chỉ người nhận là bắt buộc"),RECEIVER_WARD:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_DISTRICT:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_PROVINCE:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_ADDR:g().min(1,"Địa chỉ người nhận là bắt buộc"),PRODUCT_TYPE:g().min(1),PRODUCT_PRICE:oe(),PRODUCT_WEIGHT:oe(),ORDER_SERVICE:g().min(1),ORDER_PAYMENT:oe(),ORDER_NOTE:g().optional(),MONEY_COLLECTION:oe().optional()})),z=Ne(),_=c(null),S=c(!1),H=z.userAddress,N=c(H[0].address),m=c([]),p=c([]),P=c([]),V=c(!1),L=c([]),f=c(L.value[0]||null),se=c({}),ae=Te(()=>V.value?_.value?.states.WHO_PAY.value==="senderPay"?3:2:_.value?.states.WHO_PAY.value==="senderPay"?1:4),w=c([{PRODUCT_NAME:"",PRODUCT_QUANTITY:1,PRODUCT_WEIGHT:null,PRODUCT_PRICE:null}]),X=Te(()=>w.value.reduce((o,e)=>{const n=Number(e.PRODUCT_WEIGHT);return o+(isNaN(n)?0:n)},0)),Y=Te(()=>w.value.reduce((o,e)=>{const n=Number(e.PRODUCT_PRICE);return o+(isNaN(n)?0:n)},0)),B=()=>{w.value.push({PRODUCT_NAME:"",PRODUCT_QUANTITY:1,PRODUCT_WEIGHT:null,PRODUCT_PRICE:null})},Q=o=>{if(w.value.length>1)w.value.splice(o,1);else return},v=async()=>{try{const o=await j.get("/connector/viettelpost/provinces");o.data.success?m.value=o.data.data.data:b.error(o.data.message||"Lỗi khi lấy tỉnh/thành phố")}catch(o){b.error("Lỗi khi lấy tỉnh/thành phố"),console.error(o)}},ue=async o=>{const e=m.value.find(n=>n.PROVINCE_NAME===o)?.PROVINCE_ID;if(!e){b.error("Không tìm thấy Id tỉnh");return}try{const n=await j.get("/connector/viettelpost/districts",{params:{provinceId:e}});n.data.success?p.value=n.data.data.data:b.error(n.data.message||"Lỗi khi lấy quận/huyện")}catch(n){b.error("Lỗi khi lấy quận/huyện"),console.error(n)}},de=async o=>{const e=p.value.find(n=>n.DISTRICT_NAME===o)?.DISTRICT_ID;if(!e){b.error("Không tìm thấy Id quận");return}try{const n=await j.get("/connector/viettelpost/wards",{params:{districtId:e}});n.data.success?P.value=n.data.data.data:b.error(n.data.message||"Lỗi khi lấy phường/xã")}catch(n){b.error("Lỗi khi lấy phường/xã"),console.error(n)}};le(Y,()=>{_.value.setFieldValue("PRODUCT_PRICE",Y.value)}),le(X,()=>{_.value.setFieldValue("PRODUCT_WEIGHT",X.value)}),le(V,()=>{_.value.setFieldValue("MONEY_COLLECTION",V.value?Y.value:void 0)}),le(ae,()=>{_.value.setFieldValue("ORDER_PAYMENT",ae.value)});const ce=async o=>{try{const e=await j.post("/connector/viettelpost/price-all-nlp",{data:o});e.data.success&&(L.value=e.data.data.RESULT,f.value=L.value[0],_.value.setFieldValue("ORDER_SERVICE",f.value.MA_DV_CHINH),_.value.setFieldValue("RECEIVER_ADDRESS",e.data.data.RECEIVER_ADDRESS.ADDRESS))}catch(e){console.error(e)}},me=o=>{f.value=L.value.find(e=>e.MA_DV_CHINH===o.target.value)},Ee=["SENDER_FULLNAME","SENDER_ADDRESS","SENDER_PHONE","RECEIVER_FULLNAME","RECEIVER_ADDRESS","RECEIVER_PHONE","PRODUCT_PRICE","PRODUCT_WEIGHT","PRODUCT_LENGTH","PRODUCT_WIDTH","PRODUCT_HEIGHT","ORDER_PAYMENT","ORDER_SERVICE","PRODUCT_TYPE","ORDER_SERVICE_ADD","ORDER_NOTE","MONEY_COLLECTION"],pe=async o=>{if(!o.valid){console.log(o.errors),b.error("Thiếu hoặc sai thông tin");return}const e={};Ee.map(a=>{e[a]=o.values[a]}),e.PRODUCT_DETAIL=w.value;const n=w.value.map(a=>a.PRODUCT_NAME).join(",");e.PRODUCT_NAME=n;try{const a=await j.post("/connector/viettelpost/order/create-nlp",{data:e});console.log(a.data),S.value=!0,se.value=a.data.data}catch(a){b.error("Lỗi khi tạo đơn hàng"),console.error(a)}},_e=()=>{A.push(`/print-order/viettelpost?ordercode=${se.value.waybill}`)},ve=()=>{A.push("/")},Re=()=>{S.value=!1};return He(()=>{v()}),(o,e)=>(E(),I(ie,null,[s(t(be),{ref_key:"formRef",ref:_,initialValues:{SENDER_FULLNAME:t(z).user.name,SENDER_PHONE:t(z).user.phone,SENDER_ADDRESS:N.value,RECEIVER_FULLNAME:"",RECEIVER_PHONE:"",RECEIVER_PROVINCE:"",RECEIVER_DISTRICT:"",RECEIVER_WARD:"",RECEIVER_ADDR:"",RECEIVER_ADDRESS:"",PRODUCT_TYPE:"HH",PRODUCT_PRICE:0,PRODUCT_WEIGHT:0,PRODUCT_LENGTH:1,PRODUCT_WIDTH:1,PRODUCT_HEIGHT:1,ORDER_PAYMENT:null,MONEY_COLLECTION:void 0,ORDER_SERVICE:null,ORDER_NOTE:"",WHO_PAY:"senderPay"},resolver:t(R),class:"relative",onSubmit:pe},{default:i(n=>[l("div",ll,[l("div",tl,[s(t($),null,{title:i(()=>[...e[2]||(e[2]=[l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-user size-5"}),l("span",{class:"text-sm text-color font-bold"},"Người gửi")],-1)])]),content:i(()=>[l("div",sl,[s(t(q),null,{default:i(()=>[s(t(K),{class:"pi pi-user"}),s(t(M),{name:"SENDER_FULLNAME",class:"w-full",size:"small",readonly:""})]),_:1}),s(t(q),null,{default:i(()=>[s(t(K),{class:"pi pi-phone"}),s(t(M),{name:"SENDER_PHONE",class:"w-full",size:"small",readonly:""})]),_:1}),s(t(G),{name:"SENDER_ADDRESS",options:t(H),optionValue:"address",optionLabel:"address",class:"w-full",size:"small",checkmark:""},null,8,["options"])])]),_:1}),s(t($),null,{title:i(()=>[...e[3]||(e[3]=[l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-user size-5"}),l("span",{class:"text-sm text-color font-bold"},"Người nhận")],-1)])]),content:i(()=>[l("div",al,[l("div",nl,[s(t(q),{class:"w-full"},{default:i(()=>[s(t(K),{class:"pi pi-user"}),s(t(M),{name:"RECEIVER_FULLNAME",placeholder:"Tên người nhận",class:"w-full",size:"small"})]),_:1}),s(t(q),{class:"w-full"},{default:i(()=>[s(t(K),{class:"pi pi-phone"}),s(t(M),{name:"RECEIVER_PHONE",placeholder:"Số điện thoại người nhận",class:"w-full",size:"small"})]),_:1})]),l("div",ol,[s(t(G),{name:"RECEIVER_PROVINCE",options:m.value,optionValue:"PROVINCE_NAME",optionLabel:"PROVINCE_NAME",placeholder:"Tỉnh/thành phố",class:"w-full",size:"small",onChange:a=>ue(n.RECEIVER_PROVINCE.value),filter:""},null,8,["options","onChange"]),s(t(G),{name:"RECEIVER_DISTRICT",options:p.value,optionValue:"DISTRICT_NAME",optionLabel:"DISTRICT_NAME",placeholder:"Quận/huyện",class:"w-full",size:"small",onChange:a=>de(n.RECEIVER_DISTRICT.value),filter:""},null,8,["options","onChange"]),s(t(G),{name:"RECEIVER_WARD",options:P.value,optionValue:"WARDS_NAME",optionLabel:"WARDS_NAME",placeholder:"Xã/phường",class:"w-full",size:"small",filter:""},null,8,["options"])]),s(t(k),{variant:"on"},{default:i(()=>[s(t(M),{name:"RECEIVER_ADDR",class:"w-full",size:"small"}),e[4]||(e[4]=l("label",{for:"RECEIVER_ADDR"},"Địa chỉ",-1))]),_:1}),s(t(M),{name:"RECEIVER_ADDRESS",class:"hidden"})])]),_:2},1024),s(t($),null,{title:i(()=>[...e[5]||(e[5]=[l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-truck"}),l("span",{class:"text-sm text-color font-bold"},"Dịch vụ")],-1)])]),content:i(()=>[s(t(re),{name:"ORDER_SERVICE",onChange:me},{default:i(()=>[l("div",il,[(E(!0),I(ie,null,Ce(L.value,a=>(E(),I("div",{key:a.MA_DV_CHINH,class:"flex items-center gap-2"},[s(t(ee),{id:a.MA_DV_CHINH,value:a.MA_DV_CHINH,size:"small"},null,8,["id","value"]),l("label",{for:a.MA_DV_CHINH},h(a.TEN_DICHVU),9,rl)]))),128))])]),_:1}),f.value?(E(),I("div",ul,[l("div",dl,[e[6]||(e[6]=l("span",{class:"font-medium"}," Mã dịch vụ: ",-1)),l("span",cl,h(f.value?.MA_DV_CHINH),1)]),l("div",ml,[e[7]||(e[7]=l("span",{class:"font-medium"}," Giá cước: ",-1)),l("span",El,h(f.value?.GIA_CUOC?t(te)(f.value?.GIA_CUOC):null),1)]),l("div",pl,[e[8]||(e[8]=l("span",{class:"font-medium"}," Thời gian dự kiến: ",-1)),l("span",_l,h(f.value?.THOI_GIAN||null),1)])])):F("",!0)]),_:1})]),l("div",vl,[s(t($),null,{title:i(()=>[...e[9]||(e[9]=[l("div",{class:"flex items-center gap-2"},[l("i",{class:"pi pi-shopping-cart"}),l("span",{class:"text-sm text-color font-bold"},"Thông tin hàng hóa")],-1)])]),content:i(()=>[l("div",Rl,[l("div",fl,[e[12]||(e[12]=l("span",{class:"text-sm text-color font-medium"},"Loại hàng hóa:",-1)),s(t(re),{name:"PRODUCT_TYPE",class:"flex items-center gap-12"},{default:i(()=>[l("div",Tl,[s(t(ee),{value:"HH",inputId:"typeHH",size:"small",checked:""}),e[10]||(e[10]=l("label",{for:"typeHH",class:"text-sm text-color"},"Bưu phẩm",-1))]),l("div",Cl,[s(t(ee),{value:"TH",inputId:"typeTH",size:"small"}),e[11]||(e[11]=l("label",{for:"typeTH",class:"text-sm text-color"},"Tài liệu",-1))])]),_:1})]),l("div",hl,[(E(!0),I(ie,null,Ce(w.value,(a,r)=>(E(),I("div",{key:r,class:"py-4"},[l("div",Dl,[s(t(k),{variant:"on"},{default:i(()=>[s(t(M),{id:"productName",modelValue:a.PRODUCT_NAME,"onUpdate:modelValue":d=>a.PRODUCT_NAME=d,size:"small",fluid:""},null,8,["modelValue","onUpdate:modelValue"]),e[13]||(e[13]=l("label",{for:"productName"},"Tên hàng hóa",-1))]),_:2},1024),s(t(x),{onClick:d=>Q(r),variant:"outlined",icon:"pi pi-trash",size:"small",severity:"danger"},null,8,["onClick"])]),l("div",gl,[s(t(k),{variant:"on"},{default:i(()=>[s(t(U),{id:"productQuantity",modelValue:a.PRODUCT_QUANTITY,"onUpdate:modelValue":d=>a.PRODUCT_QUANTITY=d,size:"small",fluid:"",class:"text-sm",mode:"decimal",showButtons:""},null,8,["modelValue","onUpdate:modelValue"]),e[14]||(e[14]=l("label",{for:"productQuantity"},"Số lượng",-1))]),_:2},1024),s(t(k),{variant:"on"},{default:i(()=>[s(t(U),{id:"productWeight",modelValue:a.PRODUCT_WEIGHT,"onUpdate:modelValue":d=>a.PRODUCT_WEIGHT=d,size:"small",fluid:"",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]),e[15]||(e[15]=l("label",{for:"productWeight"},"Cân nặng (g)",-1))]),_:2},1024),s(t(k),{variant:"on"},{default:i(()=>[s(t(U),{id:"productPrice",modelValue:a.PRODUCT_PRICE,"onUpdate:modelValue":d=>a.PRODUCT_PRICE=d,size:"small",fluid:"",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]),e[16]||(e[16]=l("label",{for:"productPrice"},"Giá (VNĐ)",-1))]),_:2},1024)])]))),128)),l("div",Ol,[s(t(x),{onClick:B,variant:"outlined",label:"Thêm",icon:"pi pi-plus",size:"small"})]),l("div",xl,[e[20]||(e[20]=l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-info-circle size-5"}),l("span",{class:"text-sm text-color font-medium"},"Kích thước hàng hóa")],-1)),l("div",Il,[s(t(k),{variant:"on"},{default:i(()=>[s(t(U),{id:"productLength",name:"PRODUCT_LENGTH",size:"small",fluid:"",format:!1}),e[17]||(e[17]=l("label",{for:"productLength"},"Dài(cm)",-1))]),_:1}),s(t(k),{variant:"on"},{default:i(()=>[s(t(U),{id:"productWidth",name:"PRODUCT_WIDTH",size:"small",fluid:"",format:!1}),e[18]||(e[18]=l("label",{for:"productWidth"},"Rộng(cm)",-1))]),_:1}),s(t(k),{variant:"on"},{default:i(()=>[s(t(U),{id:"productHeight",name:"PRODUCT_HEIGHT",size:"small",fluid:"",format:!1}),e[19]||(e[19]=l("label",{for:"productHeight"},"Cao(cm)",-1))]),_:1})])]),l("div",Nl,[l("div",Pl,[e[21]||(e[21]=l("span",{class:"text-sm font-medium text-color"},"Tổng trọng lượng:",-1)),l("span",Vl,h(t(Me)(X.value))+"g",1)]),l("div",yl,[e[22]||(e[22]=l("span",{class:"text-sm font-medium text-color"},"Tổng giá tiền:",-1)),l("span",bl,h(t(te)(Y.value)),1)]),s(t(U),{id:"productPrice",name:"PRODUCT_PRICE",size:"small",class:"hidden!",readonly:""}),s(t(U),{id:"productWeight",name:"PRODUCT_WEIGHT",size:"small",class:"hidden!",readonly:""}),s(t(U),{id:"orderPayment",name:"ORDER_PAYMENT",size:"small",class:"hidden!",readonly:""})])])])]),_:1}),s(t($),null,{title:i(()=>[...e[23]||(e[23]=[l("div",{class:"flex items-center gap-2"},[l("i",{class:"pi pi-money-bill size-5"}),l("span",{class:"text-color font-bold text-sm"},"Tiền thu hộ")],-1)])]),content:i(()=>[l("div",Ul,[s(t(Ye),{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),id:"isCod",name:"isCod",size:"small",binary:""},null,8,["modelValue"]),e[24]||(e[24]=l("label",{for:"isCod",class:"text-sm"},"Thu hộ bằng tiền hàng",-1))]),s(t(U),{modelValue:V.value?Y.value:0,id:"codAmount",name:"MONEY_COLLECTION",size:"small",fluid:"",readonly:"",suffix:" VNĐ",class:"mt-2"},null,8,["modelValue"]),l("div",Al,[e[27]||(e[27]=l("span",{class:"text-sm text-color font-medium"},"Người trả cước",-1)),s(t(re),{name:"WHO_PAY",class:"flex items-center gap-8"},{default:i(()=>[l("div",Sl,[s(t(ee),{id:"senderPay",value:"senderPay",size:"small"}),e[25]||(e[25]=l("label",{for:"senderPay",class:"text-sm"},"Người gửi",-1))]),l("div",Hl,[s(t(ee),{id:"receiverPay",value:"receiverPay",size:"small"}),e[26]||(e[26]=l("label",{for:"receiverPay",class:"text-sm"},"Người nhận",-1))])]),_:1})]),l("div",Ll,[s(t(k),{variant:"on"},{default:i(()=>[s(t($e),{name:"ORDER_NOTE",fluid:"",class:"text-sm"}),e[28]||(e[28]=l("label",{for:"ORDER_NOTE"},"Ghi chú",-1))]),_:1})])]),_:1})])]),s(el,{form:n,onAllFieldsHaveValue:ce},null,8,["form"]),s(t($),{class:"myDock"},{content:i(()=>[l("div",wl,[l("div",Ml,[e[29]||(e[29]=l("span",{class:"font-medium"},"Tổng cước: ",-1)),l("span",zl,h(f.value?.GIA_CUOC?t(te)(f.value?.GIA_CUOC):0),1)]),l("div",kl,[e[30]||(e[30]=l("span",{class:"font-medium"},"Thời gian dự kiến: ",-1)),l("span",Yl,h(f.value?.THOI_GIAN||0),1)]),l("div",$l,[e[31]||(e[31]=l("span",{class:"font-medium"},"Tiền thu hộ: ",-1)),l("span",Gl,h(_.value?.states.MONEY_COLLECTION.value?t(te)(_.value?.states.MONEY_COLLECTION.value):0),1)]),l("div",Wl,[s(t(x),{type:"submit",label:"Tạo đơn",icon:"pi pi-check",size:"small"}),s(t(x),{variant:"outlined",severity:"info",label:"Lưu nháp",icon:"pi pi-file",size:"small"})])])]),_:1})]),_:1},8,["initialValues","resolver"]),s(t(Ge),{visible:S.value,"onUpdate:visible":e[1]||(e[1]=n=>S.value=n),modal:"",header:"Tạo đơn thành công",style:{width:"28rem"}},{default:i(()=>[l("div",Fl,[s(t(x),{onClick:_e,severity:"success",label:"In vận đơn",icon:"pi pi-print",size:"small",class:"min-w-32"}),s(t(x),{onClick:ve,severity:"info",variant:"outlined",label:"Về trang chủ",icon:"pi pi-home",size:"small",class:"min-w-32"}),s(t(x),{onClick:Re,severity:"secondary",variant:"outlined",label:"Tạo đơn mới",icon:"pi pi-plus",size:"small",class:"min-w-32"})])]),_:1},8,["visible"])],64))}},Bl=Pe(jl,[["__scopeId","data-v-8b17a8f4"]]),Ql={class:"text-sm text-color"},Jl={class:"flex items-end justify-between"},ql={class:"flex items-center gap-1"},Kl={class:"font-italic text-primary underline select-none"},Xl={class:"flex items-center justify-end gap-4"},Zl={class:"flex items-center gap-2"},et={class:"flex items-center justify-between"},lt={class:"flex items-center gap-2"},tt={class:"text-xs text-color"},st={key:1,class:"text-xs text-color"},at={class:"text-xs text-color"},nt={class:"text-xs text-color"},ot={__name:"BatchOrderCreate",setup(O){const A=Ie(),R=Ne(),z=c(R.userAddress),_=c(z.value[0]),S=c(R.user?.name),H=c(R.user?.phone),N=c([]),m=c([]),p=c([]),P=c(!1),V=c([]),L=c(!1),f={"Tên người nhận (*)":"RECEIVER_FULLNAME","Số ĐT người nhận (*)":"RECEIVER_PHONE","Địa chỉ nhận (*)":"RECEIVER_ADDRESS","Tên hàng hóa (*)":"PRODUCT_NAME","Số lượng":"PRODUCT_QUANTITY","Trọng lượng (gram)  (*)":"PRODUCT_WEIGHT","Dài (cm)":"PRODUCT_LENGTH","Rộng (cm)":"PRODUCT_WIDTH","Cao (cm)":"PRODUCT_HEIGHT","Giá trị hàng (VND) (*)":"PRODUCT_PRICE","Tiền thu hộ COD (VND)":"MONEY_COLLECTION","Loại hàng hóa (*)":"PRODUCT_TYPE","Người trả cước":"PAYMENT_OBJECT","Yêu cầu khác":"ORDER_NOTE"},se={RECEIVER_FULLNAME:"min-width: 140px;",RECEIVER_PHONE:"min-width: 150px;",RECEIVER_ADDRESS:"min-width: 320px;",PRODUCT_NAME:"min-width: 220px;",PRODUCT_QUANTITY:"min-width: 80px;",PRODUCT_WEIGHT:"min-width: 180px;",PRODUCT_PRICE:"min-width: 180px;",MONEY_COLLECTION:"min-width: 180px;",PRODUCT_TYPE:"min-width: 140px;",PAYMENT_OBJECT:"min-width: 140px;",ORDER_NOTE:"min-width: 220px;"},ae=[{name:"Người nhận trả",value:"Người nhận trả"},{name:"Người gửi trả",value:"Người gửi trả"}],w=[{name:"Bưu kiện",value:"Bưu kiện"},{name:"Tài liệu",value:"Tài liệu"}],X=(o,e)=>{const n=r=>r.replace(/\s+/g," ").trim(),a=new Set(e.map(n));return o.every(r=>a.has(n(r)))},Y=c(null),B=c(null),Q=c(""),v=c([]),ue=()=>{B.value=null,Q.value="",v.value=[],P.value=!1,N.value=[],m.value=[],p.value=[]},de=o=>{ue(),B.value=o.target.files[0],Q.value=o.target.files[0].name;const e=new FileReader;e.onload=n=>{const a=new Uint8Array(n.target.result),r=We(a,{type:"array"}),d=r.SheetNames[0],T=r.Sheets[d];let u=Fe.sheet_to_json(T,{defval:""});u=u.map(C=>{const D={...C};return delete D.STT,delete D["Mã đơn hàng "],D}),u=u.map(C=>{const D={};for(const[ne,fe]of Object.entries(C))ne.includes("EMPTY")||(D[ne.trim()]=fe);return D}),u=u.filter(C=>Object.values(C).some(D=>D!==""&&D!==null&&D!==void 0));const Z=Object.keys(f),W=Object.keys(u[0]);if(!X(Z,W)){b.error("File template không đúng"),B.value=null,Q.value="",v.value=[];return}v.value=u.map(C=>{let D={};return Object.entries(C).map(([ne,fe])=>{D[f[ne]]=fe}),D}),N.value=new Array(v.value.length).fill(null),m.value=new Array(v.value.length).fill(null),p.value=new Array(v.value.length).fill(null),V.value=new Array(v.value.length).fill(null)},e.readAsArrayBuffer(B.value)},ce=o=>{o.value!==o.newValue&&(v.value[o.index][o.field]=o.newValue,P.value=!1,N.value=new Array(v.value.length).fill(null),m.value=new Array(v.value.length).fill(null),p.value=new Array(v.value.length).fill(null))},me=async()=>{N.value=new Array(v.value.length).fill(null),m.value=new Array(v.value.length).fill(null),p.value=new Array(v.value.length).fill(null);const o=v.value.map(a=>{let r={};return r.SENDER_ADDRESS=_.value.address,r.RECEIVER_ADDRESS=a.RECEIVER_ADDRESS,r.PRODUCT_TYPE=a.PRODUCT_TYPE==="Tai lieu"?"TH":"HH",r.PRODUCT_WEIGHT=a.PRODUCT_WEIGHT,r.PRODUCT_PRICE=a.PRODUCT_PRICE,r.MONEY_COLLECTION=a.MONEY_COLLECTION,r.PRODUCT_WIDTH=a.PRODUCT_WIDTH||null,r.PRODUCT_HEIGHT=a.PRODUCT_HEIGHT||null,r.PRODUCT_LENGTH=a.PRODUCT_LENGTH||null,r.TYPE=1,r}),e=10,n=ge(o,e);for(let a=0;a<n.length;a++){const d=n[a].map((u,Z)=>{const W=a*e+Z;return j.post("/connector/viettelpost/price-all-nlp",{data:u}).then(C=>({res:C,idx:W})).catch(C=>({err:C,idx:W}))});(await Promise.allSettled(d)).map(u=>{u.status==="fulfilled"&&!u.value.res?.data?.data?.error?(N.value[u.value.idx]=u.value.res.data.data.RESULT,m.value[u.value.idx]=u.value.res.data.data.RESULT[0],p.value[u.value.idx]={status:"success",message:"Đơn hợp lệ"}):p.value[u.value.idx]={status:"error",message:"Đơn không hợp lệ"}})}P.value=!0},Ee=(o,e)=>{m.value[o]=N.value[o].find(n=>n.MA_DV_CHINH===e),console.log("Selected service:",m.value[o])},pe=async()=>{const o=v.value.map((a,r)=>{let{PAYMENT_OBJECT:d,...T}=a;return T.SENDER_FULLNAME=S.value,T.SENDER_PHONE=H.value,T.SENDER_ADDRESS=_.value.address,T.PRODUCT_TYPE=a.PRODUCT_TYPE==="Tài liệu"?"TH":"HH",T.ORDER_SERVICE=m.value[r]?.MA_DV_CHINH||null,T.PRODUCT_DETAIL=[],a.MONEY_COLLECTION?a.PAYMENT_OBJECT==="Người nhận trả"?T.ORDER_PAYMENT=2:T.ORDER_PAYMENT=3:a.PAYMENT_OBJECT==="Người nhận trả"?T.ORDER_PAYMENT=4:T.ORDER_PAYMENT=1,T}),e=10,n=ge(o,e);for(let a=0;a<n.length;a++){const d=n[a].map((u,Z)=>{const W=a*e+Z;return j.post("/connector/viettelpost/order/create-nlp",{data:u}).then(C=>({res:C,index:W})).catch(C=>({err:C,index:W}))});(await Promise.allSettled(d)).forEach(u=>{u.status==="fulfilled"?u.value.err?p.value[u.value.index]={status:"error",message:"Tạo đơn thất bại"}:u.value.res.data?.success?(p.value[u.value.index]={status:"success",message:"Tạo đơn thành công"},V.value[u.value.index]=u.value.res.data.data):p.value[u.value.index]={status:"error",message:"Tạo đơn thất bại"}:p.value[u.value.index]={status:"error",message:"Tạo đơn thất bại"}})}L.value=!0},_e={VIETTEL_POST:"viettelpost",YUNDA:"yunda"},ve=o=>{const e=V.value[o],n=_e[e.carrier],a=e.waybill,r=`/print-order/${n}?ordercode=${a}`,d=A.resolve(r);window.open(d.href,"_blank")},Re=()=>{const o=document.createElement("a");o.href="/docs/batch-orders.xlsx",o.download="batch-orders.xlsx",document.body.appendChild(o),o.click(),document.body.removeChild(o)};return(o,e)=>(E(),I("div",Ql,[l("div",Jl,[l("div",ql,[e[3]||(e[3]=l("i",{class:"pi pi-file-excel text-primary mb-1"},null,-1)),e[4]||(e[4]=l("span",null,"File: ",-1)),l("span",Kl,h(Q.value),1)]),l("div",Xl,[l("input",{ref_key:"fileInput",ref:Y,type:"file",accept:".xlsx,.xls,.csv",class:"hidden",onChange:de},null,544),s(t(x),{icon:"pi pi-upload",label:"Upload",size:"small",onClick:e[0]||(e[0]=n=>Y.value.click())}),s(t(x),{icon:"pi pi-download",variant:"outlined",severity:"info",label:"File mẫu",size:"small",onClick:Re})])]),s(t($),{class:"mt-4"},{title:i(()=>[...e[5]||(e[5]=[l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-user size-5"}),l("span",{class:"font-semibold text-color text-sm"},"Thông tin người gửi")],-1)])]),content:i(()=>[l("div",Zl,[s(t(q),null,{default:i(()=>[s(t(K),{class:"pi pi-address-book"}),s(t(M),{size:"small",readonly:"",value:S.value},null,8,["value"])]),_:1}),s(t(q),null,{default:i(()=>[s(t(K),{class:"pi pi-phone"}),s(t(M),{size:"small",readonly:"",value:H.value},null,8,["value"])]),_:1}),s(t(G),{options:z.value,optionLabel:"address",modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=n=>_.value=n),size:"small",fluid:"",onChange:e[2]||(e[2]=n=>console.log(_.value))},null,8,["options","modelValue"])])]),_:1}),v.value.length?(E(),y(t($),{key:0,class:"mt-4"},{title:i(()=>[l("div",et,[e[6]||(e[6]=l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-list size-5 mt-1"}),l("span",{class:"font-semibold text-color text-sm"},"Danh sách đơn hàng")],-1)),l("div",lt,[s(t(x),{icon:"pi pi-check",variant:"outlined",severity:"info",label:"Xác nhận",size:"small",onClick:me}),P.value?(E(),y(t(x),{key:0,onClick:pe,icon:"pi pi-file-plus",size:"small",label:"Tạo đơn"})):F("",!0)])])]),content:i(()=>[e[7]||(e[7]=l("div",{class:"mb-2"},[l("span",{class:"text-xs text-orange-600"},"Lưu ý(*): Các thay đổi ( trừ phần dịch vụ ) sẽ cần xác nhận lại các đơn hàng")],-1)),s(t(ke),{value:v.value,editMode:"cell",onCellEditComplete:ce,showGridlines:"",scrollable:"",scrollHeight:"flex",size:"small"},{default:i(()=>[s(t(J),{frozen:"",alignFrozen:"left",field:"STT",header:"STT",style:{"min-width":"50px"},class:"frozen-column-emerald"},{body:i(n=>[l("div",tt,h(n.index),1)]),_:1}),L.value?(E(),y(t(J),{key:0,frozen:"",alignFrozen:"left",header:"In đơn",style:{"min-width":"64px"},class:"frozen-column-emerald"},{body:i(n=>[V.value[n.index]?(E(),y(t(x),{key:0,icon:"pi pi-print",size:"small",onClick:a=>ve(n.index)},null,8,["onClick"])):F("",!0)]),_:1})):F("",!0),s(t(J),{frozen:"",alignFrozen:"left",field:"Trạng thái",header:"Trạng thái",style:{"min-width":"120px"},class:"frozen-column-emerald"},{body:i(n=>[P.value?(E(),I("div",{key:0,class:Le(["text-xs text-color",[p.value[n.index]?.status==="success"?"text-primary-600":"text-red-600"]])},h(p.value[n.index].message),3)):(E(),I("div",st,"Chưa xác nhận"))]),_:1}),L.value?F("",!0):(E(),y(t(J),{key:1,frozen:"",alignFrozen:"left",field:"Dịch vụ",header:"Dịch vụ",style:{"min-width":"250px","font-size":"12px"},class:"frozen-column-emerald"},{body:i(n=>[l("span",null,h(m.value[n.index]?`${m.value[n.index].MA_DV_CHINH} - ${m.value[n.index].TEN_DICHVU}`:""),1)]),editor:i(({data:n,field:a,index:r})=>[s(t(G),{options:N.value[r],optionValue:"MA_DV_CHINH",optionLabel:"TEN_DICHVU",placeholder:"Chọn dịch vụ",size:"small",fluid:"","onUpdate:modelValue":d=>Ee(r,d)},null,8,["options","onUpdate:modelValue"])]),_:1})),L.value?F("",!0):(E(),y(t(J),{key:2,frozen:"",alignFrozen:"left",field:"Giá cước",header:"Giá cước",style:{"min-width":"100px"},class:"frozen-column-emerald"},{body:i(n=>[l("div",at,h(m.value[n.index]?t(te)(m.value[n.index].GIA_CUOC):""),1)]),_:1})),(E(!0),I(ie,null,Ce(Object.entries(f),n=>(E(),y(t(J),{key:n[0],field:n[1],header:n[0],style:we(se[n[1]])},{body:i(({data:a,field:r})=>[l("div",nt,h(a[r]),1)]),editor:i(({data:a,field:r})=>[r==="PRODUCT_QUANTITY"||r==="PRODUCT_WEIGHT"||r==="PRODUCT_PRICE"||r==="MONEY_COLLECTION"?(E(),y(t(U),{key:0,modelValue:a[r],"onUpdate:modelValue":d=>a[r]=d,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):r==="PAYMENT_OBJECT"?(E(),y(t(G),{key:1,options:ae,optionLabel:"name",optionValue:"value",modelValue:a[r],"onUpdate:modelValue":d=>a[r]=d,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):r==="PRODUCT_TYPE"?(E(),y(t(G),{key:2,size:"small",options:w,optionLabel:"name",optionValue:"value",modelValue:a[r],"onUpdate:modelValue":d=>a[r]=d},null,8,["modelValue","onUpdate:modelValue"])):(E(),y(t(M),{key:3,modelValue:a[r],"onUpdate:modelValue":d=>a[r]=d,size:"small"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1},8,["field","header","style"]))),128))]),_:1},8,["value"])]),_:1})):F("",!0)]))}},it={__name:"index",setup(O){return(A,R)=>(E(),I("div",null,[s(t(je),{value:"1"},{default:i(()=>[s(t(Be),null,{default:i(()=>[s(t(Oe),{value:"1",as:"div",class:"flex items-center gap-1"},{default:i(()=>[...R[0]||(R[0]=[l("i",{class:"pi pi-file-check"},null,-1),De(" Đơn lẻ ",-1)])]),_:1}),s(t(Oe),{value:"2",as:"div",class:"flex items-center gap-1"},{default:i(()=>[...R[1]||(R[1]=[l("i",{class:"pi pi-list-check"},null,-1),De(" Đơn excel ",-1)])]),_:1})]),_:1}),s(t(Qe),{class:"mt-4"},{default:i(()=>[s(t(xe),{value:"1"},{default:i(()=>[s(Bl)]),_:1}),s(t(xe),{value:"2"},{default:i(()=>[s(ot)]),_:1})]),_:1})]),_:1})]))}},It=Pe(it,[["__scopeId","data-v-f8410de7"]]);export{It as default};
