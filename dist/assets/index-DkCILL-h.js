import{h as Ve,o as Ue,n as ie,s as g,a as Ae}from"./schemas--iTa1Wle.js";import"./index-DhCtX0vz.js";import{B as Se,V as Oe,c as y,o as p,k as He,m as Le,r as m,X as le,J as De,U as Pe,Z as be,L as Ce,M as we,a as l,w as r,b as t,N as e,y as d,j,F as re,q as Te,P as B,R as A,e as U,n as Me,p as ze,A as xe}from"./index-Ba0-uRri.js";import{f as se,c as ke,d as Ie}from"./helpers-DvEhqxW7.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Y}from"./index-D5SxelaQ.js";import{e as $e,c as K,d as X,a as w}from"./index-BESmW-u8.js";import{b as G}from"./index-DAcr8GVB.js";import{s as z}from"./index-Bft8jWOf.js";import{c as te,a as Ye,b as q}from"./index-CAuO7AWp.js";import{s as b}from"./index-BF9koIpW.js";import{s as S}from"./index-Gy2Ib5eE.js";import{s as Ge}from"./index-ZuTC74PY.js";import{s as We}from"./index-DtRvBZWx.js";import{s as Fe}from"./index-Dxu6QYF5.js";import{r as je,u as Be,s as Qe,a as Je,b as ge,c as qe,d as Ne}from"./xlsx-BfcxLu_P.js";import"./index-MfaGrLR4.js";import"./index-CFOeyZcx.js";var Ke=`
    .p-radiobutton-group {
        display: inline-flex;
    }
`,Xe={root:"p-radiobutton-group p-component"},Ze=Se.extend({name:"radiobuttongroup",style:Ke,classes:Xe}),et={name:"BaseRadioButtonGroup",extends:$e,style:Ze,provide:function(){return{$pcRadioButtonGroup:this,$parentInstance:this}}},ce={name:"RadioButtonGroup",extends:et,inheritAttrs:!1,data:function(){return{groupName:this.name}},watch:{name:function(o){this.groupName=o||Oe("radiobutton-group-")}},mounted:function(){this.groupName=this.groupName||Oe("radiobutton-group-")}};function tt(N,o,O,x,M,v){return p(),y("div",Le({class:N.cx("root")},N.ptmi("root")),[He(N.$slots,"default")],16)}ce.render=tt;const lt={__name:"index",props:{form:Object},emits:["allFieldsHaveValue"],setup(N,{emit:o}){const O=N,x=o,M=["SENDER_ADDRESS","SENDER_FULLNAME","SENDER_PHONE","RECEIVER_FULLNAME","RECEIVER_PHONE","RECEIVER_PROVINCE","RECEIVER_DISTRICT","RECEIVER_WARD","RECEIVER_ADDR","PRODUCT_TYPE","PRODUCT_WEIGHT"],v=["SENDER_ADDRESS","PRODUCT_TYPE","PRODUCT_PRICE","PRODUCT_WEIGHT","PRODUCT_LENGTH","PRODUCT_WIDTH","PRODUCT_HEIGHT","TYPE","MONEY_COLLECTION"],P=m({});le(()=>M.map(h=>O.form[h]?.value),h=>{h.every(f=>f&&f!=="")&&W()},{deep:!0});function W(){v.map(E=>{P.value[E]=O.form[E]?.value});const h=`${O.form.RECEIVER_ADDR?.value}, ${O.form.RECEIVER_WARD?.value}, ${O.form.RECEIVER_DISTRICT?.value}, ${O.form.RECEIVER_PROVINCE?.value}`;P.value.RECEIVER_ADDRESS=h,P.value.TYPE=1,x("allFieldsHaveValue",P.value)}return(h,E)=>null}},st={class:"flex gap-8 pb-4"},at={class:"flex flex-col gap-4 w-3/5"},nt={class:"flex items-center gap-1"},ot={class:"text-sm text-color font-bold"},it={class:"flex flex-col gap-4"},rt={class:"flex items-center gap-1"},ct={class:"text-sm text-color font-bold"},dt={class:"flex flex-col gap-4"},ut={class:"flex items-center gap-2"},_t={class:"flex items-center gap-2"},mt={class:"flex items-center gap-1"},pt={class:"text-sm text-color font-bold"},Et={class:"grid grid-cols-3 gap-8 text-sm text-color"},vt=["for"],Rt={key:0,class:"mt-4 border-t border-surface flex items-center gap-12 pt-4 text-sm text-color"},ft={class:"flex items-center gap-2"},ht={class:"font-bold text-red-500"},Ct={class:"flex items-center gap-2"},Tt={class:"font-bold text-red-500"},Dt={class:"flex items-center gap-2"},Ot={class:"font-bold text-red-500"},xt={class:"flex flex-col gap-4 w-2/5"},It={class:"flex items-center gap-2"},gt={class:"text-sm text-color font-bold"},Nt={class:"flex flex-col gap-3"},Pt={class:"flex flex-col gap-2 mt-4"},bt={class:"text-sm text-color font-medium"},yt={class:"flex items-center gap-2"},Vt={for:"typeHH",class:"text-sm text-color"},Ut={class:"flex items-center gap-2"},At={for:"typeTH",class:"text-sm text-color"},St={class:"mt-2 border-t border-surface py-4 flex flex-col divide-y divide-dashed divide-surface-300"},Ht={class:"flex items-center gap-4"},Lt={for:"productName"},wt={class:"flex items-center gap-2 mt-4"},Mt={for:"productQuantity"},zt={for:"productWeight"},kt={for:"productPrice"},$t={class:"flex items-center justify-end py-4"},Yt={class:"py-4 flex flex-col gap-2"},Gt={class:"flex items-center gap-1"},Wt={class:"text-sm text-color font-medium"},Ft={class:"grid grid-cols-3 gap-2"},jt={for:"productLength"},Bt={for:"productWidth"},Qt={for:"productHeight"},Jt={class:"mt-4 border-t border-surface py-4"},qt={class:"flex items-center justify-between"},Kt={class:"text-sm font-medium text-color"},Xt={class:"text-sm font-semibold text-red-600"},Zt={class:"flex items-center justify-between"},el={class:"text-sm font-medium text-color"},tl={class:"text-sm font-semibold text-red-600"},ll={class:"flex items-center gap-2"},sl={class:"text-color font-bold text-sm"},al={class:"flex items-center gap-2"},nl={for:"isCod",class:"text-sm"},ol={class:"flex flex-col gap-2 mt-4"},il={class:"text-sm text-color font-medium"},rl={class:"flex items-center gap-1"},cl={for:"senderPay",class:"text-sm"},dl={class:"flex items-center gap-1"},ul={for:"receiverPay",class:"text-sm"},_l={class:"mt-4"},ml={for:"ORDER_NOTE"},pl={class:"grid grid-cols-4 gap-2 text-sm text-color"},El={class:"flex items-center gap-2"},vl={class:"font-medium"},Rl={class:"font-bold text-red-500"},fl={class:"flex items-center gap-2"},hl={class:"font-medium"},Cl={class:"font-bold text-red-500"},Tl={class:"flex items-center gap-2"},Dl={class:"font-medium"},Ol={class:"font-bold text-red-500"},xl={class:"flex items-center gap-2"},Il={class:"flex items-center justify-between gap-2"},gl={__name:"SingleOrderCreate",setup(N){const{t:o}=De(),O=Pe(),x=Ve(Ue({SENDER_ADDRESS:g().min(1,"Địa chỉ người gửi là bắt buộc"),SENDER_FULLNAME:g().min(1,"Tên người gửi là bắt buộc"),SENDER_PHONE:g().min(1,"Số điện thoại người gửi là bắt buộc"),RECEIVER_FULLNAME:g().min(1,"Tên người nhận là bắt buộc"),RECEIVER_PHONE:g().min(1,"Số điện thoại người nhận là bắt buộc"),RECEIVER_ADDRESS:g().min(1,"Địa chỉ người nhận là bắt buộc"),RECEIVER_WARD:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_DISTRICT:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_PROVINCE:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_ADDR:g().min(1,"Địa chỉ người nhận là bắt buộc"),PRODUCT_TYPE:g().min(1),PRODUCT_PRICE:ie(),PRODUCT_WEIGHT:ie(),ORDER_SERVICE:g().min(1),ORDER_PAYMENT:ie(),ORDER_NOTE:g().optional(),MONEY_COLLECTION:ie().optional()})),M=be(),v=m(null),P=m(!1),W=M.userAddress,h=m(W[0].address),E=m([]),f=m([]),k=m([]),V=m(!1),H=m([]),C=m(H.value[0]||null),ae=m({}),ne=Ce(()=>V.value?v.value?.states.WHO_PAY.value==="senderPay"?3:2:v.value?.states.WHO_PAY.value==="senderPay"?1:4),L=m([{PRODUCT_NAME:"",PRODUCT_QUANTITY:1,PRODUCT_WEIGHT:null,PRODUCT_PRICE:null}]),Z=Ce(()=>L.value.reduce((i,s)=>{const n=Number(s.PRODUCT_WEIGHT);return i+(isNaN(n)?0:n)},0)),$=Ce(()=>L.value.reduce((i,s)=>{const n=Number(s.PRODUCT_PRICE);return i+(isNaN(n)?0:n)},0)),Q=()=>{L.value.push({PRODUCT_NAME:"",PRODUCT_QUANTITY:1,PRODUCT_WEIGHT:null,PRODUCT_PRICE:null})},J=i=>{if(L.value.length>1)L.value.splice(i,1);else return},R=async()=>{try{const i=await B.get("/connector/viettelpost/provinces");i.data.success?E.value=i.data.data.data:A.error(i.data.message||"Lỗi khi lấy tỉnh/thành phố")}catch(i){A.error("Lỗi khi lấy tỉnh/thành phố"),console.error(i)}},de=async i=>{const s=E.value.find(n=>n.PROVINCE_NAME===i)?.PROVINCE_ID;if(!s){A.error("Không tìm thấy Id tỉnh");return}try{const n=await B.get("/connector/viettelpost/districts",{params:{provinceId:s}});n.data.success?f.value=n.data.data.data:A.error(n.data.message||"Lỗi khi lấy quận/huyện")}catch(n){A.error("Lỗi khi lấy quận/huyện"),console.error(n)}},ue=async i=>{const s=f.value.find(n=>n.DISTRICT_NAME===i)?.DISTRICT_ID;if(!s){A.error("Không tìm thấy Id quận");return}try{const n=await B.get("/connector/viettelpost/wards",{params:{districtId:s}});n.data.success?k.value=n.data.data.data:A.error(n.data.message||"Lỗi khi lấy phường/xã")}catch(n){A.error("Lỗi khi lấy phường/xã"),console.error(n)}};le($,()=>{v.value.setFieldValue("PRODUCT_PRICE",$.value)}),le(Z,()=>{v.value.setFieldValue("PRODUCT_WEIGHT",Z.value)}),le(V,()=>{v.value.setFieldValue("MONEY_COLLECTION",V.value?$.value:void 0)}),le(ne,()=>{v.value.setFieldValue("ORDER_PAYMENT",ne.value)});const _e=async i=>{try{const s=await B.post("/connector/viettelpost/price-all-nlp",{data:i});s.data.success&&(H.value=s.data.data.RESULT,C.value=H.value[0],v.value.setFieldValue("ORDER_SERVICE",C.value.MA_DV_CHINH),v.value.setFieldValue("RECEIVER_ADDRESS",s.data.data.RECEIVER_ADDRESS.ADDRESS))}catch(s){console.error(s)}},me=i=>{C.value=H.value.find(s=>s.MA_DV_CHINH===i.target.value)},pe=["SENDER_FULLNAME","SENDER_ADDRESS","SENDER_PHONE","RECEIVER_FULLNAME","RECEIVER_ADDRESS","RECEIVER_PHONE","PRODUCT_PRICE","PRODUCT_WEIGHT","PRODUCT_LENGTH","PRODUCT_WIDTH","PRODUCT_HEIGHT","ORDER_PAYMENT","ORDER_SERVICE","PRODUCT_TYPE","ORDER_SERVICE_ADD","ORDER_NOTE","MONEY_COLLECTION"],Ee=async i=>{if(!i.valid){console.log(i.errors),A.error("Thiếu hoặc sai thông tin");return}const s={};pe.map(a=>{s[a]=i.values[a]}),s.PRODUCT_DETAIL=L.value;const n=L.value.map(a=>a.PRODUCT_NAME).join(",");s.PRODUCT_NAME=n;try{const a=await B.post("/connector/viettelpost/order/create-nlp",{data:s});console.log(a.data),P.value=!0,ae.value=a.data.data}catch(a){A.error("Lỗi khi tạo đơn hàng"),console.error(a)}},ve=()=>{O.push(`/print-order/viettelpost?ordercode=${ae.value.waybill}`)},Re=()=>{O.push("/")},fe=()=>{P.value=!1};return we(()=>{R()}),(i,s)=>(p(),y(re,null,[l(e(Ae),{ref_key:"formRef",ref:v,initialValues:{SENDER_FULLNAME:e(M).user.name,SENDER_PHONE:e(M).user.phone,SENDER_ADDRESS:h.value,RECEIVER_FULLNAME:"",RECEIVER_PHONE:"",RECEIVER_PROVINCE:"",RECEIVER_DISTRICT:"",RECEIVER_WARD:"",RECEIVER_ADDR:"",RECEIVER_ADDRESS:"",PRODUCT_TYPE:"HH",PRODUCT_PRICE:0,PRODUCT_WEIGHT:0,PRODUCT_LENGTH:1,PRODUCT_WIDTH:1,PRODUCT_HEIGHT:1,ORDER_PAYMENT:null,MONEY_COLLECTION:void 0,ORDER_SERVICE:null,ORDER_NOTE:"",WHO_PAY:"senderPay"},resolver:e(x),class:"relative",onSubmit:Ee},{default:r(n=>[t("div",st,[t("div",at,[l(e(Y),null,{title:r(()=>[t("div",nt,[s[2]||(s[2]=t("i",{class:"pi pi-user size-5"},null,-1)),t("span",ot,d(e(o)("sender")),1)])]),content:r(()=>[t("div",it,[l(e(K),null,{default:r(()=>[l(e(X),{class:"pi pi-user"}),l(e(w),{name:"SENDER_FULLNAME",class:"w-full",size:"small",readonly:""})]),_:1}),l(e(K),null,{default:r(()=>[l(e(X),{class:"pi pi-phone"}),l(e(w),{name:"SENDER_PHONE",class:"w-full",size:"small",readonly:""})]),_:1}),l(e(G),{name:"SENDER_ADDRESS",options:e(W),optionValue:"address",optionLabel:"address",class:"w-full",size:"small",checkmark:""},null,8,["options"])])]),_:1}),l(e(Y),null,{title:r(()=>[t("div",rt,[s[3]||(s[3]=t("i",{class:"pi pi-user size-5"},null,-1)),t("span",ct,d(e(o)("receiver")),1)])]),content:r(()=>[t("div",dt,[t("div",ut,[l(e(K),{class:"w-full"},{default:r(()=>[l(e(X),{class:"pi pi-user"}),l(e(w),{name:"RECEIVER_FULLNAME",placeholder:e(o)("receiverName"),class:"w-full",size:"small"},null,8,["placeholder"])]),_:1}),l(e(K),{class:"w-full"},{default:r(()=>[l(e(X),{class:"pi pi-phone"}),l(e(w),{name:"RECEIVER_PHONE",placeholder:e(o)("receiverPhone"),class:"w-full",size:"small"},null,8,["placeholder"])]),_:1})]),t("div",_t,[l(e(G),{name:"RECEIVER_PROVINCE",options:E.value,optionValue:"PROVINCE_NAME",optionLabel:"PROVINCE_NAME",placeholder:e(o)("receiverProvince"),class:"w-full",size:"small",onChange:a=>de(n.RECEIVER_PROVINCE.value),filter:""},null,8,["options","placeholder","onChange"]),l(e(G),{name:"RECEIVER_DISTRICT",options:f.value,optionValue:"DISTRICT_NAME",optionLabel:"DISTRICT_NAME",placeholder:e(o)("receiverDistrict"),class:"w-full",size:"small",onChange:a=>ue(n.RECEIVER_DISTRICT.value),filter:""},null,8,["options","placeholder","onChange"]),l(e(G),{name:"RECEIVER_WARD",options:k.value,optionValue:"WARDS_NAME",optionLabel:"WARDS_NAME",placeholder:e(o)("receiverWard"),class:"w-full",size:"small",filter:""},null,8,["options","placeholder"])]),l(e(z),{variant:"on"},{default:r(()=>[l(e(w),{name:"RECEIVER_ADDR",class:"w-full",size:"small"}),s[4]||(s[4]=t("label",{for:"RECEIVER_ADDR"},"Địa chỉ",-1))]),_:1}),l(e(w),{name:"RECEIVER_ADDRESS",class:"hidden"})])]),_:2},1024),l(e(Y),null,{title:r(()=>[t("div",mt,[s[5]||(s[5]=t("i",{class:"pi pi-truck"},null,-1)),t("span",pt,d(e(o)("service")),1)])]),content:r(()=>[l(e(ce),{name:"ORDER_SERVICE",onChange:me},{default:r(()=>[t("div",Et,[(p(!0),y(re,null,Te(H.value,a=>(p(),y("div",{key:a.MA_DV_CHINH,class:"flex items-center gap-2"},[l(e(te),{id:a.MA_DV_CHINH,value:a.MA_DV_CHINH,size:"small"},null,8,["id","value"]),t("label",{for:a.MA_DV_CHINH},d(a.TEN_DICHVU),9,vt)]))),128))])]),_:1}),C.value?(p(),y("div",Rt,[t("div",ft,[s[6]||(s[6]=t("span",{class:"font-medium"}," Mã dịch vụ: ",-1)),t("span",ht,d(C.value?.MA_DV_CHINH),1)]),t("div",Ct,[s[7]||(s[7]=t("span",{class:"font-medium"}," Giá cước: ",-1)),t("span",Tt,d(C.value?.GIA_CUOC?e(se)(C.value?.GIA_CUOC):null),1)]),t("div",Dt,[s[8]||(s[8]=t("span",{class:"font-medium"}," Thời gian dự kiến: ",-1)),t("span",Ot,d(C.value?.THOI_GIAN||null),1)])])):j("",!0)]),_:1})]),t("div",xt,[l(e(Y),null,{title:r(()=>[t("div",It,[s[9]||(s[9]=t("i",{class:"pi pi-shopping-cart"},null,-1)),t("span",gt,d(e(o)("productInfo")),1)])]),content:r(()=>[t("div",Nt,[t("div",Pt,[t("span",bt,d(e(o)("productType")),1),l(e(ce),{name:"PRODUCT_TYPE",class:"flex items-center gap-12"},{default:r(()=>[t("div",yt,[l(e(te),{value:"HH",inputId:"typeHH",size:"small",checked:""}),t("label",Vt,d(e(o)("package")),1)]),t("div",Ut,[l(e(te),{value:"TH",inputId:"typeTH",size:"small"}),t("label",At,d(e(o)("document")),1)])]),_:1})]),t("div",St,[(p(!0),y(re,null,Te(L.value,(a,c)=>(p(),y("div",{key:c,class:"py-4"},[t("div",Ht,[l(e(z),{variant:"on"},{default:r(()=>[l(e(w),{id:"productName",modelValue:a.PRODUCT_NAME,"onUpdate:modelValue":_=>a.PRODUCT_NAME=_,size:"small",fluid:""},null,8,["modelValue","onUpdate:modelValue"]),t("label",Lt,d(e(o)("productName")),1)]),_:2},1024),l(e(b),{onClick:_=>J(c),variant:"outlined",icon:"pi pi-trash",size:"small",severity:"danger"},null,8,["onClick"])]),t("div",wt,[l(e(z),{variant:"on"},{default:r(()=>[l(e(S),{id:"productQuantity",modelValue:a.PRODUCT_QUANTITY,"onUpdate:modelValue":_=>a.PRODUCT_QUANTITY=_,size:"small",fluid:"",class:"text-sm",mode:"decimal",showButtons:""},null,8,["modelValue","onUpdate:modelValue"]),t("label",Mt,d(e(o)("productQuantity")),1)]),_:2},1024),l(e(z),{variant:"on"},{default:r(()=>[l(e(S),{id:"productWeight",modelValue:a.PRODUCT_WEIGHT,"onUpdate:modelValue":_=>a.PRODUCT_WEIGHT=_,size:"small",fluid:"",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]),t("label",zt,d(e(o)("productWeight")),1)]),_:2},1024),l(e(z),{variant:"on"},{default:r(()=>[l(e(S),{id:"productPrice",modelValue:a.PRODUCT_PRICE,"onUpdate:modelValue":_=>a.PRODUCT_PRICE=_,size:"small",fluid:"",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]),t("label",kt,d(e(o)("productPrice")),1)]),_:2},1024)])]))),128)),t("div",$t,[l(e(b),{onClick:Q,variant:"outlined",label:"Thêm",icon:"pi pi-plus",size:"small"})]),t("div",Yt,[t("div",Gt,[s[10]||(s[10]=t("i",{class:"pi pi-info-circle size-5"},null,-1)),t("span",Wt,d(e(o)("productSize")),1)]),t("div",Ft,[l(e(z),{variant:"on"},{default:r(()=>[l(e(S),{id:"productLength",name:"PRODUCT_LENGTH",size:"small",fluid:"",format:!1}),t("label",jt,d(e(o)("productLength")),1)]),_:1}),l(e(z),{variant:"on"},{default:r(()=>[l(e(S),{id:"productWidth",name:"PRODUCT_WIDTH",size:"small",fluid:"",format:!1}),t("label",Bt,d(e(o)("productWidth")),1)]),_:1}),l(e(z),{variant:"on"},{default:r(()=>[l(e(S),{id:"productHeight",name:"PRODUCT_HEIGHT",size:"small",fluid:"",format:!1}),t("label",Qt,d(e(o)("productHeight")),1)]),_:1})])]),t("div",Jt,[t("div",qt,[t("span",Kt,d(e(o)("totalWeight")),1),t("span",Xt,d(e(ke)(Z.value))+"g",1)]),t("div",Zt,[t("span",el,d(e(o)("totalPrice")),1),t("span",tl,d(e(se)($.value)),1)]),l(e(S),{id:"productPrice",name:"PRODUCT_PRICE",size:"small",class:"hidden!",readonly:""}),l(e(S),{id:"productWeight",name:"PRODUCT_WEIGHT",size:"small",class:"hidden!",readonly:""}),l(e(S),{id:"orderPayment",name:"ORDER_PAYMENT",size:"small",class:"hidden!",readonly:""})])])])]),_:1}),l(e(Y),null,{title:r(()=>[t("div",ll,[s[11]||(s[11]=t("i",{class:"pi pi-money-bill size-5"},null,-1)),t("span",sl,d(e(o)("codMethod")),1)])]),content:r(()=>[t("div",al,[l(e(Ge),{modelValue:V.value,"onUpdate:modelValue":s[0]||(s[0]=a=>V.value=a),id:"isCod",name:"isCod",size:"small",binary:""},null,8,["modelValue"]),t("label",nl,d(e(o)("codByProductPrice")),1)]),l(e(S),{modelValue:V.value?$.value:0,id:"codAmount",name:"MONEY_COLLECTION",size:"small",fluid:"",readonly:"",suffix:" VNĐ",class:"mt-2"},null,8,["modelValue"]),t("div",ol,[t("span",il,d(e(o)("whoPay")),1),l(e(ce),{name:"WHO_PAY",class:"flex items-center gap-8"},{default:r(()=>[t("div",rl,[l(e(te),{id:"senderPay",value:"senderPay",size:"small"}),t("label",cl,d(e(o)("sender")),1)]),t("div",dl,[l(e(te),{id:"receiverPay",value:"receiverPay",size:"small"}),t("label",ul,d(e(o)("receiver")),1)])]),_:1})]),t("div",_l,[l(e(z),{variant:"on"},{default:r(()=>[l(e(We),{name:"ORDER_NOTE",fluid:"",class:"text-sm"}),t("label",ml,d(e(o)("note")),1)]),_:1})])]),_:1})])]),l(lt,{form:n,onAllFieldsHaveValue:_e},null,8,["form"]),l(e(Y),{class:"myDock"},{content:r(()=>[t("div",pl,[t("div",El,[t("span",vl,d(e(o)("totalFee"))+": ",1),t("span",Rl,d(C.value?.GIA_CUOC?e(se)(C.value?.GIA_CUOC):0),1)]),t("div",fl,[t("span",hl,d(e(o)("timeDiliver"))+": ",1),t("span",Cl,d(C.value?.THOI_GIAN||0),1)]),t("div",Tl,[t("span",Dl,d(e(o)("codMoney"))+": ",1),t("span",Ol,d(v.value?.states.MONEY_COLLECTION.value?e(se)(v.value?.states.MONEY_COLLECTION.value):0),1)]),t("div",xl,[l(e(b),{type:"submit",label:e(o)("createOrder"),icon:"pi pi-check",size:"small"},null,8,["label"]),l(e(b),{variant:"outlined",severity:"info",label:e(o)("saveDraft"),icon:"pi pi-file",size:"small"},null,8,["label"])])])]),_:1})]),_:1},8,["initialValues","resolver"]),l(e(Fe),{visible:P.value,"onUpdate:visible":s[1]||(s[1]=n=>P.value=n),modal:"",header:"Tạo đơn thành công",style:{width:"28rem"}},{default:r(()=>[t("div",Il,[l(e(b),{onClick:ve,severity:"success",label:e(o)("printOrder"),icon:"pi pi-print",size:"small",class:"min-w-32"},null,8,["label"]),l(e(b),{onClick:Re,severity:"info",variant:"outlined",label:"Về trang chủ",icon:"pi pi-home",size:"small",class:"min-w-32"}),l(e(b),{onClick:fe,severity:"secondary",variant:"outlined",label:"Tạo đơn mới",icon:"pi pi-plus",size:"small",class:"min-w-32"})])]),_:1},8,["visible"])],64))}},Nl=ye(gl,[["__scopeId","data-v-43b2e16a"]]),Pl={class:"text-sm text-color"},bl={class:"flex items-end justify-between"},yl={class:"flex items-center gap-1"},Vl={class:"font-italic text-primary underline select-none"},Ul={class:"flex items-center justify-end gap-4"},Al={class:"flex items-center gap-1"},Sl={class:"font-semibold text-color text-sm"},Hl={class:"flex items-center gap-2"},Ll={class:"flex items-center justify-between"},wl={class:"flex items-center gap-1"},Ml={class:"font-semibold text-color text-sm"},zl={class:"flex items-center gap-2"},kl={class:"mb-2"},$l={class:"text-xs text-orange-600"},Yl={class:"text-xs text-color"},Gl={key:1,class:"text-xs text-color"},Wl={class:"text-xs text-color"},Fl={class:"text-xs text-color"},jl={__name:"BatchOrderCreate",setup(N){const{t:o}=De(),O=Pe(),x=be(),M=m(x.userAddress),v=m(M.value[0]),P=m(x.user?.name),W=m(x.user?.phone),h=m([]),E=m([]),f=m([]),k=m(!1),V=m([]),H=m(!1),C={"Tên người nhận (*)":"RECEIVER_FULLNAME","Số ĐT người nhận (*)":"RECEIVER_PHONE","Địa chỉ nhận (*)":"RECEIVER_ADDRESS","Tên hàng hóa (*)":"PRODUCT_NAME","Số lượng":"PRODUCT_QUANTITY","Trọng lượng (gram)  (*)":"PRODUCT_WEIGHT","Dài (cm)":"PRODUCT_LENGTH","Rộng (cm)":"PRODUCT_WIDTH","Cao (cm)":"PRODUCT_HEIGHT","Giá trị hàng (VND) (*)":"PRODUCT_PRICE","Tiền thu hộ COD (VND)":"MONEY_COLLECTION","Loại hàng hóa (*)":"PRODUCT_TYPE","Người trả cước":"PAYMENT_OBJECT","Yêu cầu khác":"ORDER_NOTE"},ae={RECEIVER_FULLNAME:"min-width: 140px;",RECEIVER_PHONE:"min-width: 150px;",RECEIVER_ADDRESS:"min-width: 320px;",PRODUCT_NAME:"min-width: 220px;",PRODUCT_QUANTITY:"min-width: 80px;",PRODUCT_WEIGHT:"min-width: 180px;",PRODUCT_PRICE:"min-width: 180px;",MONEY_COLLECTION:"min-width: 180px;",PRODUCT_TYPE:"min-width: 140px;",PAYMENT_OBJECT:"min-width: 140px;",ORDER_NOTE:"min-width: 220px;"},ne=[{name:"Người nhận trả",value:"Người nhận trả"},{name:"Người gửi trả",value:"Người gửi trả"}],L=[{name:"Bưu kiện",value:"Bưu kiện"},{name:"Tài liệu",value:"Tài liệu"}],Z=(i,s)=>{const n=c=>c.replace(/\s+/g," ").trim(),a=new Set(s.map(n));return i.every(c=>a.has(n(c)))},$=m(null),Q=m(null),J=m(""),R=m([]),de=()=>{Q.value=null,J.value="",R.value=[],k.value=!1,h.value=[],E.value=[],f.value=[]},ue=i=>{de(),Q.value=i.target.files[0],J.value=i.target.files[0].name;const s=new FileReader;s.onload=n=>{const a=new Uint8Array(n.target.result),c=je(a,{type:"array"}),_=c.SheetNames[0],T=c.Sheets[_];let u=Be.sheet_to_json(T,{defval:""});u=u.map(D=>{const I={...D};return delete I.STT,delete I["Mã đơn hàng "],I}),u=u.map(D=>{const I={};for(const[oe,he]of Object.entries(D))oe.includes("EMPTY")||(I[oe.trim()]=he);return I}),u=u.filter(D=>Object.values(D).some(I=>I!==""&&I!==null&&I!==void 0));const ee=Object.keys(C),F=Object.keys(u[0]);if(!Z(ee,F)){A.error("File template không đúng"),Q.value=null,J.value="",R.value=[];return}R.value=u.map(D=>{let I={};return Object.entries(D).map(([oe,he])=>{I[C[oe]]=he}),I}),h.value=new Array(R.value.length).fill(null),E.value=new Array(R.value.length).fill(null),f.value=new Array(R.value.length).fill(null),V.value=new Array(R.value.length).fill(null)},s.readAsArrayBuffer(Q.value)},_e=i=>{i.value!==i.newValue&&(R.value[i.index][i.field]=i.newValue,k.value=!1,h.value=new Array(R.value.length).fill(null),E.value=new Array(R.value.length).fill(null),f.value=new Array(R.value.length).fill(null))},me=async()=>{h.value=new Array(R.value.length).fill(null),E.value=new Array(R.value.length).fill(null),f.value=new Array(R.value.length).fill(null);const i=R.value.map(a=>{let c={};return c.SENDER_ADDRESS=v.value.address,c.RECEIVER_ADDRESS=a.RECEIVER_ADDRESS,c.PRODUCT_TYPE=a.PRODUCT_TYPE==="Tai lieu"?"TH":"HH",c.PRODUCT_WEIGHT=a.PRODUCT_WEIGHT,c.PRODUCT_PRICE=a.PRODUCT_PRICE,c.MONEY_COLLECTION=a.MONEY_COLLECTION,c.PRODUCT_WIDTH=a.PRODUCT_WIDTH||null,c.PRODUCT_HEIGHT=a.PRODUCT_HEIGHT||null,c.PRODUCT_LENGTH=a.PRODUCT_LENGTH||null,c.TYPE=1,c}),s=10,n=Ie(i,s);for(let a=0;a<n.length;a++){const _=n[a].map((u,ee)=>{const F=a*s+ee;return B.post("/connector/viettelpost/price-all-nlp",{data:u}).then(D=>({res:D,idx:F})).catch(D=>({err:D,idx:F}))});(await Promise.allSettled(_)).map(u=>{u.status==="fulfilled"&&!u.value.res?.data?.data?.error?(h.value[u.value.idx]=u.value.res.data.data.RESULT,E.value[u.value.idx]=u.value.res.data.data.RESULT[0],f.value[u.value.idx]={status:"success",message:"Đơn hợp lệ"}):f.value[u.value.idx]={status:"error",message:"Đơn không hợp lệ"}})}k.value=!0},pe=(i,s)=>{E.value[i]=h.value[i].find(n=>n.MA_DV_CHINH===s),console.log("Selected service:",E.value[i])},Ee=async()=>{const i=R.value.map((a,c)=>{let{PAYMENT_OBJECT:_,...T}=a;return T.SENDER_FULLNAME=P.value,T.SENDER_PHONE=W.value,T.SENDER_ADDRESS=v.value.address,T.PRODUCT_TYPE=a.PRODUCT_TYPE==="Tài liệu"?"TH":"HH",T.ORDER_SERVICE=E.value[c]?.MA_DV_CHINH||null,T.PRODUCT_DETAIL=[],a.MONEY_COLLECTION?a.PAYMENT_OBJECT==="Người nhận trả"?T.ORDER_PAYMENT=2:T.ORDER_PAYMENT=3:a.PAYMENT_OBJECT==="Người nhận trả"?T.ORDER_PAYMENT=4:T.ORDER_PAYMENT=1,T}),s=10,n=Ie(i,s);for(let a=0;a<n.length;a++){const _=n[a].map((u,ee)=>{const F=a*s+ee;return B.post("/connector/viettelpost/order/create-nlp",{data:u}).then(D=>({res:D,index:F})).catch(D=>({err:D,index:F}))});(await Promise.allSettled(_)).forEach(u=>{u.status==="fulfilled"?u.value.err?f.value[u.value.index]={status:"error",message:"Tạo đơn thất bại"}:u.value.res.data?.success?(f.value[u.value.index]={status:"success",message:"Tạo đơn thành công"},V.value[u.value.index]=u.value.res.data.data):f.value[u.value.index]={status:"error",message:"Tạo đơn thất bại"}:f.value[u.value.index]={status:"error",message:"Tạo đơn thất bại"}})}H.value=!0},ve={VIETTEL_POST:"viettelpost",YUNDA:"yunda"},Re=i=>{const s=V.value[i],n=ve[s.carrier],a=s.waybill,c=`/print-order/${n}?ordercode=${a}`,_=O.resolve(c);window.open(_.href,"_blank")},fe=()=>{const i=document.createElement("a");i.href="/docs/batch-orders.xlsx",i.download="batch-orders.xlsx",document.body.appendChild(i),i.click(),document.body.removeChild(i)};return(i,s)=>(p(),y("div",Pl,[t("div",bl,[t("div",yl,[s[3]||(s[3]=t("i",{class:"pi pi-file-excel text-primary mb-1"},null,-1)),s[4]||(s[4]=t("span",null,"File: ",-1)),t("span",Vl,d(J.value),1)]),t("div",Ul,[t("input",{ref_key:"fileInput",ref:$,type:"file",accept:".xlsx,.xls,.csv",class:"hidden",onChange:ue},null,544),l(e(b),{icon:"pi pi-upload",label:e(o)("upload"),size:"small",onClick:s[0]||(s[0]=n=>$.value.click())},null,8,["label"]),l(e(b),{icon:"pi pi-download",variant:"outlined",severity:"info",label:e(o)("downloadTemplate"),size:"small",onClick:fe},null,8,["label"])])]),l(e(Y),{class:"mt-4"},{title:r(()=>[t("div",Al,[s[5]||(s[5]=t("i",{class:"pi pi-user size-5"},null,-1)),t("span",Sl,d(e(o)("sender")),1)])]),content:r(()=>[t("div",Hl,[l(e(K),null,{default:r(()=>[l(e(X),{class:"pi pi-address-book"}),l(e(w),{size:"small",readonly:"",value:P.value},null,8,["value"])]),_:1}),l(e(K),null,{default:r(()=>[l(e(X),{class:"pi pi-phone"}),l(e(w),{size:"small",readonly:"",value:W.value},null,8,["value"])]),_:1}),l(e(G),{options:M.value,optionLabel:"address",modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=n=>v.value=n),size:"small",fluid:"",onChange:s[2]||(s[2]=n=>console.log(v.value))},null,8,["options","modelValue"])])]),_:1}),R.value.length?(p(),U(e(Y),{key:0,class:"mt-4"},{title:r(()=>[t("div",Ll,[t("div",wl,[s[6]||(s[6]=t("i",{class:"pi pi-list size-5 mt-1"},null,-1)),t("span",Ml,d(e(o)("orderList")),1)]),t("div",zl,[l(e(b),{icon:"pi pi-check",variant:"outlined",severity:"info",label:e(o)("confirm"),size:"small",onClick:me},null,8,["label"]),k.value?(p(),U(e(b),{key:0,onClick:Ee,icon:"pi pi-file-plus",size:"small",label:e(o)("createOrder")},null,8,["label"])):j("",!0)])])]),content:r(()=>[t("div",kl,[t("span",$l,d(e(o)("orderListExcelChangedHint")),1)]),l(e(Ye),{value:R.value,editMode:"cell",onCellEditComplete:_e,showGridlines:"",scrollable:"",scrollHeight:"flex",size:"small"},{default:r(()=>[l(e(q),{frozen:"",alignFrozen:"left",field:"STT",header:"STT",style:{"min-width":"50px"},class:"frozen-column-emerald"},{body:r(n=>[t("div",Yl,d(n.index),1)]),_:1}),H.value?(p(),U(e(q),{key:0,frozen:"",alignFrozen:"left",header:e(o)("printOrder"),style:{"min-width":"64px"},class:"frozen-column-emerald"},{body:r(n=>[V.value[n.index]?(p(),U(e(b),{key:0,icon:"pi pi-print",size:"small",onClick:a=>Re(n.index)},null,8,["onClick"])):j("",!0)]),_:1},8,["header"])):j("",!0),l(e(q),{frozen:"",alignFrozen:"left",field:"Trạng thái",header:e(o)("status"),style:{"min-width":"120px"},class:"frozen-column-emerald"},{body:r(n=>[k.value?(p(),y("div",{key:0,class:Me(["text-xs text-color",[f.value[n.index]?.status==="success"?"text-primary-600":"text-red-600"]])},d(f.value[n.index].message),3)):(p(),y("div",Gl,"Chưa xác nhận"))]),_:1},8,["header"]),H.value?j("",!0):(p(),U(e(q),{key:1,frozen:"",alignFrozen:"left",field:"Dịch vụ",header:e(o)("service"),style:{"min-width":"250px","font-size":"12px"},class:"frozen-column-emerald"},{body:r(n=>[t("span",null,d(E.value[n.index]?`${E.value[n.index].MA_DV_CHINH} - ${E.value[n.index].TEN_DICHVU}`:""),1)]),editor:r(({data:n,field:a,index:c})=>[l(e(G),{options:h.value[c],optionValue:"MA_DV_CHINH",optionLabel:"TEN_DICHVU",placeholder:"Chọn dịch vụ",size:"small",fluid:"","onUpdate:modelValue":_=>pe(c,_)},null,8,["options","onUpdate:modelValue"])]),_:1},8,["header"])),H.value?j("",!0):(p(),U(e(q),{key:2,frozen:"",alignFrozen:"left",field:"Giá cước",header:e(o)("totalFee"),style:{"min-width":"100px"},class:"frozen-column-emerald"},{body:r(n=>[t("div",Wl,d(E.value[n.index]?e(se)(E.value[n.index].GIA_CUOC):""),1)]),_:1},8,["header"])),(p(!0),y(re,null,Te(Object.entries(C),n=>(p(),U(e(q),{key:n[0],field:n[1],header:e(o)(n[1]),style:ze(ae[n[1]])},{body:r(({data:a,field:c})=>[t("div",Fl,d(a[c]),1)]),editor:r(({data:a,field:c})=>[c==="PRODUCT_QUANTITY"||c==="PRODUCT_WEIGHT"||c==="PRODUCT_PRICE"||c==="MONEY_COLLECTION"?(p(),U(e(S),{key:0,modelValue:a[c],"onUpdate:modelValue":_=>a[c]=_,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):c==="PAYMENT_OBJECT"?(p(),U(e(G),{key:1,options:ne,optionLabel:"name",optionValue:"value",modelValue:a[c],"onUpdate:modelValue":_=>a[c]=_,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):c==="PRODUCT_TYPE"?(p(),U(e(G),{key:2,size:"small",options:L,optionLabel:"name",optionValue:"value",modelValue:a[c],"onUpdate:modelValue":_=>a[c]=_},null,8,["modelValue","onUpdate:modelValue"])):(p(),U(e(w),{key:3,modelValue:a[c],"onUpdate:modelValue":_=>a[c]=_,size:"small"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1},8,["field","header","style"]))),128))]),_:1},8,["value"])]),_:1})):j("",!0)]))}},Bl={__name:"index",setup(N){const{t:o}=De();return(O,x)=>(p(),y("div",null,[l(e(Qe),{value:"1"},{default:r(()=>[l(e(Je),null,{default:r(()=>[l(e(ge),{value:"1",as:"div",class:"flex items-center gap-1"},{default:r(()=>[x[0]||(x[0]=t("i",{class:"pi pi-file-check"},null,-1)),xe(" "+d(e(o)("singleOrder")),1)]),_:1}),l(e(ge),{value:"2",as:"div",class:"flex items-center gap-1"},{default:r(()=>[x[1]||(x[1]=t("i",{class:"pi pi-list-check"},null,-1)),xe(" "+d(e(o)("batchOrder")),1)]),_:1})]),_:1}),l(e(qe),{class:"mt-4"},{default:r(()=>[l(e(Ne),{value:"1"},{default:r(()=>[l(Nl)]),_:1}),l(e(Ne),{value:"2"},{default:r(()=>[l(jl)]),_:1})]),_:1})]),_:1})]))}},_s=ye(Bl,[["__scopeId","data-v-f99452e2"]]);export{_s as default};
