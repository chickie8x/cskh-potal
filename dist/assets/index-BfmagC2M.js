import{h as Pe,o as Ve,n as ie,s as g,a as ye}from"./schemas-DYlokDEL.js";import"./index-BGeuzjgU.js";import{B as be,R as Ce,c as x,o as m,k as Ue,m as Ae,r as u,U as le,N as Ie,V as xe,X as fe,J as Se,a as s,w as o,b as l,L as t,j as F,F as oe,q as Te,y as h,M as j,P as b,e as y,n as He,p as Le,A as he}from"./index-Svb1OpEq.js";import{f as te,c as we,d as De}from"./helpers-DnWjwZ6V.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as $}from"./index-SePvlrEV.js";import{e as Me,c as q,d as K,a as M}from"./index-BHX5PEbn.js";import{b as G}from"./index-wEXAf2Hi.js";import{s as Y}from"./index-DqfBSweQ.js";import{c as ee,a as ze,b as J}from"./index-BVU6jy5i.js";import{s as I}from"./index-CkAboL5O.js";import{s as U}from"./index-BdDubOrK.js";import{s as ke}from"./index-C7UvTH9h.js";import{s as Ye}from"./index-Dc6ph9Ro.js";import{s as $e}from"./index-DtaMvipa.js";import{r as Ge,u as We,s as Fe,a as je,b as ge,c as Be,d as Oe}from"./xlsx-B6oGC_g7.js";import"./index-8N4bb41Y.js";import"./index-CQkKTO2W.js";var Qe=`
    .p-radiobutton-group {
        display: inline-flex;
    }
`,Je={root:"p-radiobutton-group p-component"},qe=be.extend({name:"radiobuttongroup",style:Qe,classes:Je}),Ke={name:"BaseRadioButtonGroup",extends:Me,style:qe,provide:function(){return{$pcRadioButtonGroup:this,$parentInstance:this}}},re={name:"RadioButtonGroup",extends:Ke,inheritAttrs:!1,data:function(){return{groupName:this.name}},watch:{name:function(A){this.groupName=A||Ce("radiobutton-group-")}},mounted:function(){this.groupName=this.groupName||Ce("radiobutton-group-")}};function Xe(O,A,f,z,v,S){return m(),x("div",Ae({class:O.cx("root")},O.ptmi("root")),[Ue(O.$slots,"default")],16)}re.render=Xe;const Ze={__name:"index",props:{form:Object},emits:["allFieldsHaveValue"],setup(O,{emit:A}){const f=O,z=A,v=["SENDER_ADDRESS","SENDER_FULLNAME","SENDER_PHONE","RECEIVER_FULLNAME","RECEIVER_PHONE","RECEIVER_PROVINCE","RECEIVER_DISTRICT","RECEIVER_WARD","RECEIVER_ADDR","PRODUCT_TYPE","PRODUCT_PRICE","PRODUCT_WEIGHT"],S=["SENDER_ADDRESS","PRODUCT_TYPE","PRODUCT_PRICE","PRODUCT_WEIGHT","PRODUCT_LENGTH","PRODUCT_WIDTH","PRODUCT_HEIGHT","TYPE","MONEY_COLLECTION"],H=u({});le(()=>v.map(d=>f.form[d]?.value),d=>{d.every(P=>P&&P!=="")&&N()},{deep:!0});function N(){S.map(p=>{H.value[p]=f.form[p]?.value});const d=`${f.form.RECEIVER_ADDR?.value}, ${f.form.RECEIVER_WARD?.value}, ${f.form.RECEIVER_DISTRICT?.value}, ${f.form.RECEIVER_PROVINCE?.value}`;H.value.RECEIVER_ADDRESS=d,H.value.TYPE=1,z("allFieldsHaveValue",H.value)}return(d,p)=>null}},el={class:"flex gap-8 pb-4"},ll={class:"flex flex-col gap-4 w-3/5"},tl={class:"flex flex-col gap-4"},sl={class:"flex flex-col gap-4"},al={class:"flex items-center gap-2"},nl={class:"flex items-center gap-2"},il={class:"grid grid-cols-3 gap-8 text-sm text-color"},ol=["for"],rl={key:0,class:"mt-4 border-t border-surface flex items-center gap-12 pt-4 text-sm text-color"},ul={class:"flex items-center gap-2"},dl={class:"font-bold text-red-500"},cl={class:"flex items-center gap-2"},El={class:"font-bold text-red-500"},ml={class:"flex items-center gap-2"},pl={class:"font-bold text-red-500"},_l={class:"flex flex-col gap-4 w-2/5"},vl={class:"flex flex-col gap-3"},Rl={class:"flex flex-col gap-2 mt-4"},fl={class:"flex items-center gap-2"},Tl={class:"flex items-center gap-2"},Cl={class:"mt-2 border-t border-surface py-4 flex flex-col divide-y divide-dashed divide-surface-300"},hl={class:"flex items-center gap-4"},Dl={class:"flex items-center gap-2 mt-4"},gl={class:"flex items-center justify-end py-4"},Ol={class:"py-4 flex flex-col gap-2"},Il={class:"grid grid-cols-3 gap-2"},xl={class:"mt-4 border-t border-surface py-4"},Nl={class:"flex items-center justify-between"},Pl={class:"text-sm font-semibold text-red-600"},Vl={class:"flex items-center justify-between"},yl={class:"text-sm font-semibold text-red-600"},bl={class:"flex items-center gap-2"},Ul={class:"flex flex-col gap-2 mt-4"},Al={class:"flex items-center gap-1"},Sl={class:"flex items-center gap-1"},Hl={class:"mt-4"},Ll={class:"grid grid-cols-4 gap-2 text-sm text-color"},wl={class:"flex items-center gap-2"},Ml={class:"font-bold text-red-500"},zl={class:"flex items-center gap-2"},kl={class:"font-bold text-red-500"},Yl={class:"flex items-center gap-2"},$l={class:"font-bold text-red-500"},Gl={class:"flex items-center gap-2"},Wl={class:"flex items-center justify-between gap-2"},Fl={__name:"SingleOrderCreate",setup(O){const A=Ie(),f=Pe(Ve({SENDER_ADDRESS:g().min(1,"Địa chỉ người gửi là bắt buộc"),SENDER_FULLNAME:g().min(1,"Tên người gửi là bắt buộc"),SENDER_PHONE:g().min(1,"Số điện thoại người gửi là bắt buộc"),RECEIVER_FULLNAME:g().min(1,"Tên người nhận là bắt buộc"),RECEIVER_PHONE:g().min(1,"Số điện thoại người nhận là bắt buộc"),RECEIVER_ADDRESS:g().min(1,"Địa chỉ người nhận là bắt buộc"),RECEIVER_WARD:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_DISTRICT:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_PROVINCE:g().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_ADDR:g().min(1,"Địa chỉ người nhận là bắt buộc"),PRODUCT_TYPE:g().min(1),PRODUCT_PRICE:ie(),PRODUCT_WEIGHT:ie(),ORDER_SERVICE:g().min(1),ORDER_PAYMENT:ie(),ORDER_NOTE:g().optional(),MONEY_COLLECTION:ie().optional()})),z=xe(),v=u(null),S=u(!1),H=z.userAddress,N=u(H[0].address),d=u([]),p=u([]),P=u([]),V=u(!1),L=u([]),T=u(L.value[0]||null),se=u({}),ae=fe(()=>V.value?v.value?.states.WHO_PAY.value==="senderPay"?3:2:v.value?.states.WHO_PAY.value==="senderPay"?1:4),w=u([{PRODUCT_NAME:"",PRODUCT_QUANTITY:1,PRODUCT_WEIGHT:null,PRODUCT_PRICE:null}]),X=fe(()=>w.value.reduce((i,e)=>{const a=Number(e.PRODUCT_WEIGHT);return i+(isNaN(a)?0:a)},0)),k=fe(()=>w.value.reduce((i,e)=>{const a=Number(e.PRODUCT_PRICE);return i+(isNaN(a)?0:a)},0)),B=()=>{w.value.push({PRODUCT_NAME:"",PRODUCT_QUANTITY:1,PRODUCT_WEIGHT:null,PRODUCT_PRICE:null})},Q=i=>{if(w.value.length>1)w.value.splice(i,1);else return},R=async()=>{try{const i=await j.get("/connector/viettelpost/provinces");i.data.success?d.value=i.data.data.data:b.error(i.data.message||"Lỗi khi lấy tỉnh/thành phố")}catch(i){b.error("Lỗi khi lấy tỉnh/thành phố"),console.error(i)}},ue=async i=>{const e=d.value.find(a=>a.PROVINCE_NAME===i)?.PROVINCE_ID;if(!e){b.error("Không tìm thấy Id tỉnh");return}try{const a=await j.get("/connector/viettelpost/districts",{params:{provinceId:e}});a.data.success?p.value=a.data.data.data:b.error(a.data.message||"Lỗi khi lấy quận/huyện")}catch(a){b.error("Lỗi khi lấy quận/huyện"),console.error(a)}},de=async i=>{const e=p.value.find(a=>a.DISTRICT_NAME===i)?.DISTRICT_ID;if(!e){b.error("Không tìm thấy Id quận");return}try{const a=await j.get("/connector/viettelpost/wards",{params:{districtId:e}});a.data.success?P.value=a.data.data.data:b.error(a.data.message||"Lỗi khi lấy phường/xã")}catch(a){b.error("Lỗi khi lấy phường/xã"),console.error(a)}};le(k,()=>{v.value.setFieldValue("PRODUCT_PRICE",k.value)}),le(X,()=>{v.value.setFieldValue("PRODUCT_WEIGHT",X.value)}),le(V,()=>{v.value.setFieldValue("MONEY_COLLECTION",V.value?k.value:null)}),le(ae,()=>{v.value.setFieldValue("ORDER_PAYMENT",ae.value)});const ce=async i=>{try{const e=await j.post("/connector/viettelpost/price-all-nlp",{data:i});e.data.success&&(L.value=e.data.data.RESULT,T.value=L.value[0],v.value.setFieldValue("ORDER_SERVICE",T.value.MA_DV_CHINH),v.value.setFieldValue("RECEIVER_ADDRESS",e.data.data.RECEIVER_ADDRESS.ADDRESS))}catch(e){console.error(e)}},Ee=i=>{T.value=L.value.find(e=>e.MA_DV_CHINH===i.target.value)},me=["SENDER_FULLNAME","SENDER_ADDRESS","SENDER_PHONE","RECEIVER_FULLNAME","RECEIVER_ADDRESS","RECEIVER_PHONE","PRODUCT_PRICE","PRODUCT_WEIGHT","PRODUCT_LENGTH","PRODUCT_WIDTH","PRODUCT_HEIGHT","ORDER_PAYMENT","ORDER_SERVICE","PRODUCT_TYPE","ORDER_SERVICE_ADD","ORDER_NOTE","MONEY_COLLECTION"],pe=async i=>{if(!i.valid){b.error("Thiếu hoặc sai thông tin");return}const e={};me.map(n=>{e[n]=i.values[n]}),e.PRODUCT_DETAIL=w.value;const a=w.value.map(n=>n.PRODUCT_NAME).join(",");e.PRODUCT_NAME=a;try{const n=await j.post("/connector/viettelpost/order/create-nlp",{data:e});console.log(n.data),S.value=!0,se.value=n.data.data}catch(n){b.error("Lỗi khi tạo đơn hàng"),console.error(n)}},_e=()=>{A.push(`/print-order/viettelpost?ordercode=${se.value.waybill}`)},ve=()=>{A.push("/")},E=()=>{S.value=!1};return Se(()=>{R()}),(i,e)=>(m(),x(oe,null,[s(t(ye),{ref_key:"formRef",ref:v,initialValues:{SENDER_FULLNAME:t(z).user.name,SENDER_PHONE:t(z).user.phone,SENDER_ADDRESS:N.value,RECEIVER_FULLNAME:"",RECEIVER_PHONE:"",RECEIVER_PROVINCE:"",RECEIVER_DISTRICT:"",RECEIVER_WARD:"",RECEIVER_ADDR:"",RECEIVER_ADDRESS:"",PRODUCT_TYPE:"HH",PRODUCT_PRICE:null,PRODUCT_WEIGHT:null,PRODUCT_LENGTH:null,PRODUCT_WIDTH:null,PRODUCT_HEIGHT:null,ORDER_PAYMENT:null,MONEY_COLLECTION:void 0,ORDER_SERVICE:null,ORDER_NOTE:"",WHO_PAY:"senderPay"},resolver:t(f),class:"relative",onSubmit:pe},{default:o(a=>[l("div",el,[l("div",ll,[s(t($),null,{title:o(()=>[...e[2]||(e[2]=[l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-user size-5"}),l("span",{class:"text-sm text-color font-bold"},"Người gửi")],-1)])]),content:o(()=>[l("div",tl,[s(t(q),null,{default:o(()=>[s(t(K),{class:"pi pi-user"}),s(t(M),{name:"SENDER_FULLNAME",class:"w-full",size:"small",readonly:""})]),_:1}),s(t(q),null,{default:o(()=>[s(t(K),{class:"pi pi-phone"}),s(t(M),{name:"SENDER_PHONE",class:"w-full",size:"small",readonly:""})]),_:1}),s(t(G),{name:"SENDER_ADDRESS",options:t(H),optionValue:"address",optionLabel:"address",class:"w-full",size:"small",checkmark:""},null,8,["options"])])]),_:1}),s(t($),null,{title:o(()=>[...e[3]||(e[3]=[l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-user size-5"}),l("span",{class:"text-sm text-color font-bold"},"Người nhận")],-1)])]),content:o(()=>[l("div",sl,[l("div",al,[s(t(q),{class:"w-full"},{default:o(()=>[s(t(K),{class:"pi pi-user"}),s(t(M),{name:"RECEIVER_FULLNAME",placeholder:"Tên người nhận",class:"w-full",size:"small"})]),_:1}),s(t(q),{class:"w-full"},{default:o(()=>[s(t(K),{class:"pi pi-phone"}),s(t(M),{name:"RECEIVER_PHONE",placeholder:"Số điện thoại người nhận",class:"w-full",size:"small"})]),_:1})]),l("div",nl,[s(t(G),{name:"RECEIVER_PROVINCE",options:d.value,optionValue:"PROVINCE_NAME",optionLabel:"PROVINCE_NAME",placeholder:"Tỉnh/thành phố",class:"w-full",size:"small",onChange:n=>ue(a.RECEIVER_PROVINCE.value)},null,8,["options","onChange"]),s(t(G),{name:"RECEIVER_DISTRICT",options:p.value,optionValue:"DISTRICT_NAME",optionLabel:"DISTRICT_NAME",placeholder:"Quận/huyện",class:"w-full",size:"small",onChange:n=>de(a.RECEIVER_DISTRICT.value)},null,8,["options","onChange"]),s(t(G),{name:"RECEIVER_WARD",options:P.value,optionValue:"WARDS_NAME",optionLabel:"WARDS_NAME",placeholder:"Xã/phường",class:"w-full",size:"small"},null,8,["options"])]),s(t(Y),{variant:"on"},{default:o(()=>[s(t(M),{name:"RECEIVER_ADDR",class:"w-full",size:"small"}),e[4]||(e[4]=l("label",{for:"RECEIVER_ADDR"},"Địa chỉ",-1))]),_:1}),s(t(M),{name:"RECEIVER_ADDRESS",class:"hidden"})])]),_:2},1024),s(t($),null,{title:o(()=>[...e[5]||(e[5]=[l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-truck"}),l("span",{class:"text-sm text-color font-bold"},"Dịch vụ")],-1)])]),content:o(()=>[s(t(re),{name:"ORDER_SERVICE",onChange:Ee},{default:o(()=>[l("div",il,[(m(!0),x(oe,null,Te(L.value,n=>(m(),x("div",{key:n.MA_DV_CHINH,class:"flex items-center gap-2"},[s(t(ee),{id:n.MA_DV_CHINH,value:n.MA_DV_CHINH,size:"small"},null,8,["id","value"]),l("label",{for:n.MA_DV_CHINH},h(n.TEN_DICHVU),9,ol)]))),128))])]),_:1}),T.value?(m(),x("div",rl,[l("div",ul,[e[6]||(e[6]=l("span",{class:"font-medium"}," Mã dịch vụ: ",-1)),l("span",dl,h(T.value?.MA_DV_CHINH),1)]),l("div",cl,[e[7]||(e[7]=l("span",{class:"font-medium"}," Giá cước: ",-1)),l("span",El,h(T.value?.GIA_CUOC?t(te)(T.value?.GIA_CUOC):null),1)]),l("div",ml,[e[8]||(e[8]=l("span",{class:"font-medium"}," Thời gian dự kiến: ",-1)),l("span",pl,h(T.value?.THOI_GIAN||null),1)])])):F("",!0)]),_:1})]),l("div",_l,[s(t($),null,{title:o(()=>[...e[9]||(e[9]=[l("div",{class:"flex items-center gap-2"},[l("i",{class:"pi pi-shopping-cart"}),l("span",{class:"text-sm text-color font-bold"},"Thông tin hàng hóa")],-1)])]),content:o(()=>[l("div",vl,[l("div",Rl,[e[12]||(e[12]=l("span",{class:"text-sm text-color font-medium"},"Loại hàng hóa:",-1)),s(t(re),{name:"PRODUCT_TYPE",class:"flex items-center gap-12"},{default:o(()=>[l("div",fl,[s(t(ee),{value:"HH",inputId:"typeHH",size:"small",checked:""}),e[10]||(e[10]=l("label",{for:"typeHH",class:"text-sm text-color"},"Bưu phẩm",-1))]),l("div",Tl,[s(t(ee),{value:"TH",inputId:"typeTH",size:"small"}),e[11]||(e[11]=l("label",{for:"typeTH",class:"text-sm text-color"},"Tài liệu",-1))])]),_:1})]),l("div",Cl,[(m(!0),x(oe,null,Te(w.value,(n,_)=>(m(),x("div",{key:_,class:"py-4"},[l("div",hl,[s(t(Y),{variant:"on"},{default:o(()=>[s(t(M),{id:"productName",modelValue:n.PRODUCT_NAME,"onUpdate:modelValue":c=>n.PRODUCT_NAME=c,size:"small",fluid:""},null,8,["modelValue","onUpdate:modelValue"]),e[13]||(e[13]=l("label",{for:"productName"},"Tên hàng hóa",-1))]),_:2},1024),s(t(I),{onClick:c=>Q(_),variant:"outlined",icon:"pi pi-trash",size:"small",severity:"danger"},null,8,["onClick"])]),l("div",Dl,[s(t(Y),{variant:"on"},{default:o(()=>[s(t(U),{id:"productQuantity",modelValue:n.PRODUCT_QUANTITY,"onUpdate:modelValue":c=>n.PRODUCT_QUANTITY=c,size:"small",fluid:"",class:"text-sm",mode:"decimal",showButtons:""},null,8,["modelValue","onUpdate:modelValue"]),e[14]||(e[14]=l("label",{for:"productQuantity"},"Số lượng",-1))]),_:2},1024),s(t(Y),{variant:"on"},{default:o(()=>[s(t(U),{id:"productWeight",modelValue:n.PRODUCT_WEIGHT,"onUpdate:modelValue":c=>n.PRODUCT_WEIGHT=c,size:"small",fluid:"",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]),e[15]||(e[15]=l("label",{for:"productWeight"},"Cân nặng (g)",-1))]),_:2},1024),s(t(Y),{variant:"on"},{default:o(()=>[s(t(U),{id:"productPrice",modelValue:n.PRODUCT_PRICE,"onUpdate:modelValue":c=>n.PRODUCT_PRICE=c,size:"small",fluid:"",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]),e[16]||(e[16]=l("label",{for:"productPrice"},"Giá (VNĐ)",-1))]),_:2},1024)])]))),128)),l("div",gl,[s(t(I),{onClick:B,variant:"outlined",label:"Thêm",icon:"pi pi-plus",size:"small"})]),l("div",Ol,[e[20]||(e[20]=l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-info-circle size-5"}),l("span",{class:"text-sm text-color font-medium"},"Kích thước hàng hóa")],-1)),l("div",Il,[s(t(Y),{variant:"on"},{default:o(()=>[s(t(U),{id:"productLength",name:"PRODUCT_LENGTH",size:"small",fluid:"",format:!1}),e[17]||(e[17]=l("label",{for:"productLength"},"Dài(cm)",-1))]),_:1}),s(t(Y),{variant:"on"},{default:o(()=>[s(t(U),{id:"productWidth",name:"PRODUCT_WIDTH",size:"small",fluid:"",format:!1}),e[18]||(e[18]=l("label",{for:"productWidth"},"Rộng(cm)",-1))]),_:1}),s(t(Y),{variant:"on"},{default:o(()=>[s(t(U),{id:"productHeight",name:"PRODUCT_HEIGHT",size:"small",fluid:"",format:!1}),e[19]||(e[19]=l("label",{for:"productHeight"},"Cao(cm)",-1))]),_:1})])]),l("div",xl,[l("div",Nl,[e[21]||(e[21]=l("span",{class:"text-sm font-medium text-color"},"Tổng trọng lượng:",-1)),l("span",Pl,h(t(we)(X.value))+"g",1)]),l("div",Vl,[e[22]||(e[22]=l("span",{class:"text-sm font-medium text-color"},"Tổng giá tiền:",-1)),l("span",yl,h(t(te)(k.value)),1)]),s(t(U),{id:"productPrice",name:"PRODUCT_PRICE",size:"small",class:"hidden!",readonly:""}),s(t(U),{id:"productWeight",name:"PRODUCT_WEIGHT",size:"small",class:"hidden!",readonly:""}),s(t(U),{id:"orderPayment",name:"ORDER_PAYMENT",size:"small",class:"hidden!",readonly:""})])])])]),_:1}),s(t($),null,{title:o(()=>[...e[23]||(e[23]=[l("div",{class:"flex items-center gap-2"},[l("i",{class:"pi pi-money-bill size-5"}),l("span",{class:"text-color font-bold text-sm"},"Tiền thu hộ")],-1)])]),content:o(()=>[l("div",bl,[s(t(ke),{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=n=>V.value=n),id:"isCod",name:"isCod",size:"small",binary:""},null,8,["modelValue"]),e[24]||(e[24]=l("label",{for:"isCod",class:"text-sm"},"Thu hộ bằng tiền hàng",-1))]),s(t(U),{modelValue:V.value?k.value:null,id:"codAmount",name:"MONEY_COLLECTION",size:"small",fluid:"",readonly:"",suffix:" VNĐ",class:"mt-2"},null,8,["modelValue"]),l("div",Ul,[e[27]||(e[27]=l("span",{class:"text-sm text-color font-medium"},"Người trả cước",-1)),s(t(re),{name:"WHO_PAY",class:"flex items-center gap-8"},{default:o(()=>[l("div",Al,[s(t(ee),{id:"senderPay",value:"senderPay",size:"small"}),e[25]||(e[25]=l("label",{for:"senderPay",class:"text-sm"},"Người gửi",-1))]),l("div",Sl,[s(t(ee),{id:"receiverPay",value:"receiverPay",size:"small"}),e[26]||(e[26]=l("label",{for:"receiverPay",class:"text-sm"},"Người nhận",-1))])]),_:1})]),l("div",Hl,[s(t(Y),{variant:"on"},{default:o(()=>[s(t(Ye),{name:"ORDER_NOTE",fluid:"",class:"text-sm"}),e[28]||(e[28]=l("label",{for:"ORDER_NOTE"},"Ghi chú",-1))]),_:1})])]),_:1})])]),s(Ze,{form:a,onAllFieldsHaveValue:ce},null,8,["form"]),s(t($),{class:"myDock"},{content:o(()=>[l("div",Ll,[l("div",wl,[e[29]||(e[29]=l("span",{class:"font-medium"},"Tổng cước: ",-1)),l("span",Ml,h(T.value?.GIA_CUOC?t(te)(T.value?.GIA_CUOC):0),1)]),l("div",zl,[e[30]||(e[30]=l("span",{class:"font-medium"},"Thời gian dự kiến: ",-1)),l("span",kl,h(T.value?.THOI_GIAN||0),1)]),l("div",Yl,[e[31]||(e[31]=l("span",{class:"font-medium"},"Tiền thu hộ: ",-1)),l("span",$l,h(v.value?.states.MONEY_COLLECTION.value?t(te)(v.value?.states.MONEY_COLLECTION.value):0),1)]),l("div",Gl,[s(t(I),{type:"submit",label:"Tạo đơn",icon:"pi pi-check",size:"small"}),s(t(I),{variant:"outlined",severity:"info",label:"Lưu nháp",icon:"pi pi-file",size:"small"})])])]),_:1})]),_:1},8,["initialValues","resolver"]),s(t($e),{visible:S.value,"onUpdate:visible":e[1]||(e[1]=a=>S.value=a),modal:"",header:"Tạo đơn thành công",style:{width:"28rem"}},{default:o(()=>[l("div",Wl,[s(t(I),{onClick:_e,severity:"success",label:"In vận đơn",icon:"pi pi-print",size:"small",class:"min-w-32"}),s(t(I),{onClick:ve,severity:"info",variant:"outlined",label:"Về trang chủ",icon:"pi pi-home",size:"small",class:"min-w-32"}),s(t(I),{onClick:E,severity:"secondary",variant:"outlined",label:"Tạo đơn mới",icon:"pi pi-plus",size:"small",class:"min-w-32"})])]),_:1},8,["visible"])],64))}},jl=Ne(Fl,[["__scopeId","data-v-fa3a6c49"]]),Bl={class:"text-sm text-color"},Ql={class:"flex items-end justify-between"},Jl={class:"flex items-center gap-1"},ql={class:"font-italic text-primary underline select-none"},Kl={class:"flex items-center justify-end gap-4"},Xl={class:"flex items-center gap-2"},Zl={class:"flex items-center justify-between"},et={class:"flex items-center gap-2"},lt={class:"text-xs text-color"},tt={key:1,class:"text-xs text-color"},st={class:"text-xs text-color"},at={class:"text-xs text-color"},nt={__name:"BatchOrderCreate",setup(O){const A=Ie(),f=xe(),z=u(f.userAddress),v=u(z.value[0]),S=u(f.user?.name),H=u(f.user?.phone),N=u([]),d=u([]),p=u([]),P=u(!1),V=u([]),L=u(!1),T={"Tên người nhận (*)":"RECEIVER_FULLNAME","Số ĐT người nhận (*)":"RECEIVER_PHONE","Địa chỉ nhận (*)":"RECEIVER_ADDRESS","Tên hàng hóa (*)":"PRODUCT_NAME","Số lượng":"PRODUCT_QUANTITY","Trọng lượng (gram)  (*)":"PRODUCT_WEIGHT","Dài (cm)":"PRODUCT_LENGTH","Rộng (cm)":"PRODUCT_WIDTH","Cao (cm)":"PRODUCT_HEIGHT","Giá trị hàng (VND) (*)":"PRODUCT_PRICE","Tiền thu hộ COD (VND)":"MONEY_COLLECTION","Loại hàng hóa (*)":"PRODUCT_TYPE","Người trả cước":"PAYMENT_OBJECT","Yêu cầu khác":"ORDER_NOTE"},se={RECEIVER_FULLNAME:"min-width: 140px;",RECEIVER_PHONE:"min-width: 150px;",RECEIVER_ADDRESS:"min-width: 320px;",PRODUCT_NAME:"min-width: 220px;",PRODUCT_QUANTITY:"min-width: 80px;",PRODUCT_WEIGHT:"min-width: 180px;",PRODUCT_PRICE:"min-width: 180px;",MONEY_COLLECTION:"min-width: 180px;",PRODUCT_TYPE:"min-width: 140px;",PAYMENT_OBJECT:"min-width: 140px;",ORDER_NOTE:"min-width: 220px;"},ae=[{name:"Người nhận trả",value:"Người nhận trả"},{name:"Người gửi trả",value:"Người gửi trả"}],w=[{name:"Bưu kiện",value:"Bưu kiện"},{name:"Tài liệu",value:"Tài liệu"}],X=(E,i)=>{const e=n=>n.replace(/\s+/g," ").trim(),a=new Set(i.map(e));return E.every(n=>a.has(e(n)))},k=u(null),B=u(null),Q=u(""),R=u([]),ue=()=>{B.value=null,Q.value="",R.value=[],P.value=!1,N.value=[],d.value=[],p.value=[]},de=E=>{ue(),B.value=E.target.files[0],Q.value=E.target.files[0].name;const i=new FileReader;i.onload=e=>{const a=new Uint8Array(e.target.result),n=Ge(a,{type:"array"}),_=n.SheetNames[0],c=n.Sheets[_];let r=We.sheet_to_json(c,{defval:""});r=r.map(C=>{const D={...C};return delete D.STT,delete D["Mã đơn hàng "],D}),r=r.map(C=>{const D={};for(const[ne,Re]of Object.entries(C))ne.includes("EMPTY")||(D[ne.trim()]=Re);return D}),r=r.filter(C=>Object.values(C).some(D=>D!==""&&D!==null&&D!==void 0));const Z=Object.keys(T),W=Object.keys(r[0]);if(!X(Z,W)){b.error("File template không đúng"),B.value=null,Q.value="",R.value=[];return}R.value=r.map(C=>{let D={};return Object.entries(C).map(([ne,Re])=>{D[T[ne]]=Re}),D}),N.value=new Array(R.value.length).fill(null),d.value=new Array(R.value.length).fill(null),p.value=new Array(R.value.length).fill(null),V.value=new Array(R.value.length).fill(null)},i.readAsArrayBuffer(B.value)},ce=E=>{E.value!==E.newValue&&(R.value[E.index][E.field]=E.newValue,P.value=!1,N.value=new Array(R.value.length).fill(null),d.value=new Array(R.value.length).fill(null),p.value=new Array(R.value.length).fill(null))},Ee=async()=>{N.value=new Array(R.value.length).fill(null),d.value=new Array(R.value.length).fill(null),p.value=new Array(R.value.length).fill(null);const E=R.value.map(a=>{let n={};return n.SENDER_ADDRESS=v.value.address,n.RECEIVER_ADDRESS=a.RECEIVER_ADDRESS,n.PRODUCT_TYPE=a.PRODUCT_TYPE==="Tai lieu"?"TH":"HH",n.PRODUCT_WEIGHT=a.PRODUCT_WEIGHT,n.PRODUCT_PRICE=a.PRODUCT_PRICE,n.MONEY_COLLECTION=a.MONEY_COLLECTION,n.PRODUCT_WIDTH=a.PRODUCT_WIDTH||null,n.PRODUCT_HEIGHT=a.PRODUCT_HEIGHT||null,n.PRODUCT_LENGTH=a.PRODUCT_LENGTH||null,n.TYPE=1,n}),i=10,e=De(E,i);for(let a=0;a<e.length;a++){const _=e[a].map((r,Z)=>{const W=a*i+Z;return j.post("/connector/viettelpost/price-all-nlp",{data:r}).then(C=>({res:C,idx:W})).catch(C=>({err:C,idx:W}))});(await Promise.allSettled(_)).map(r=>{r.status==="fulfilled"&&!r.value.res?.data?.data?.error?(N.value[r.value.idx]=r.value.res.data.data.RESULT,d.value[r.value.idx]=r.value.res.data.data.RESULT[0],p.value[r.value.idx]={status:"success",message:"Đơn hợp lệ"}):p.value[r.value.idx]={status:"error",message:"Đơn không hợp lệ"}})}P.value=!0},me=(E,i)=>{d.value[E]=N.value[E].find(e=>e.MA_DV_CHINH===i),console.log("Selected service:",d.value[E])},pe=async()=>{const E=R.value.map((a,n)=>{let{PAYMENT_OBJECT:_,...c}=a;return c.SENDER_FULLNAME=S.value,c.SENDER_PHONE=H.value,c.SENDER_ADDRESS=v.value.address,c.PRODUCT_TYPE=a.PRODUCT_TYPE==="Tài liệu"?"TH":"HH",c.ORDER_SERVICE=d.value[n]?.MA_DV_CHINH||null,c.PRODUCT_DETAIL=[],a.MONEY_COLLECTION?a.PAYMENT_OBJECT==="Người nhận trả"?c.ORDER_PAYMENT=2:c.ORDER_PAYMENT=3:a.PAYMENT_OBJECT==="Người nhận trả"?c.ORDER_PAYMENT=4:c.ORDER_PAYMENT=1,c}),i=10,e=De(E,i);for(let a=0;a<e.length;a++){const _=e[a].map((r,Z)=>{const W=a*i+Z;return j.post("/connector/viettelpost/order/create-nlp",{data:r}).then(C=>({res:C,index:W})).catch(C=>({err:C,index:W}))});(await Promise.allSettled(_)).forEach(r=>{r.status==="fulfilled"?r.value.err?p.value[r.value.index]={status:"error",message:"Tạo đơn thất bại"}:r.value.res.data?.success?(p.value[r.value.index]={status:"success",message:"Tạo đơn thành công"},V.value[r.value.index]=r.value.res.data.data):p.value[r.value.index]={status:"error",message:"Tạo đơn thất bại"}:p.value[r.value.index]={status:"error",message:"Tạo đơn thất bại"}})}L.value=!0},_e={VIETTEL_POST:"viettelpost",YUNDA:"yunda"},ve=E=>{const i=V.value[E],e=_e[i.carrier],a=i.waybill,n=`/print-order/${e}?ordercode=${a}`,_=A.resolve(n);window.open(_.href,"_blank")};return(E,i)=>(m(),x("div",Bl,[l("div",Ql,[l("div",Jl,[i[4]||(i[4]=l("i",{class:"pi pi-file-excel text-primary mb-1"},null,-1)),i[5]||(i[5]=l("span",null,"File: ",-1)),l("span",ql,h(Q.value),1)]),l("div",Kl,[l("input",{ref_key:"fileInput",ref:k,type:"file",accept:".xlsx,.xls,.csv",class:"hidden",onChange:de},null,544),s(t(I),{icon:"pi pi-upload",label:"Upload",size:"small",onClick:i[0]||(i[0]=e=>k.value.click())}),s(t(I),{icon:"pi pi-download",variant:"outlined",severity:"info",label:"File mẫu",size:"small",onClick:i[1]||(i[1]=e=>k.value.value=null)})])]),s(t($),{class:"mt-4"},{title:o(()=>[...i[6]||(i[6]=[l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-user size-5"}),l("span",{class:"font-semibold text-color text-sm"},"Thông tin người gửi")],-1)])]),content:o(()=>[l("div",Xl,[s(t(q),null,{default:o(()=>[s(t(K),{class:"pi pi-address-book"}),s(t(M),{size:"small",readonly:"",value:S.value},null,8,["value"])]),_:1}),s(t(q),null,{default:o(()=>[s(t(K),{class:"pi pi-phone"}),s(t(M),{size:"small",readonly:"",value:H.value},null,8,["value"])]),_:1}),s(t(G),{options:z.value,optionLabel:"address",modelValue:v.value,"onUpdate:modelValue":i[2]||(i[2]=e=>v.value=e),size:"small",fluid:"",onChange:i[3]||(i[3]=e=>console.log(v.value))},null,8,["options","modelValue"])])]),_:1}),R.value.length?(m(),y(t($),{key:0,class:"mt-4"},{title:o(()=>[l("div",Zl,[i[7]||(i[7]=l("div",{class:"flex items-center gap-1"},[l("i",{class:"pi pi-list size-5 mt-1"}),l("span",{class:"font-semibold text-color text-sm"},"Danh sách đơn hàng")],-1)),l("div",et,[s(t(I),{icon:"pi pi-check",variant:"outlined",severity:"info",label:"Xác nhận",size:"small",onClick:Ee}),P.value?(m(),y(t(I),{key:0,onClick:pe,icon:"pi pi-file-plus",size:"small",label:"Tạo đơn"})):F("",!0)])])]),content:o(()=>[i[8]||(i[8]=l("div",{class:"mb-2"},[l("span",{class:"text-xs text-orange-600"},"Lưu ý(*): Các thay đổi ( trừ phần dịch vụ ) sẽ cần xác nhận lại các đơn hàng")],-1)),s(t(ze),{value:R.value,editMode:"cell",onCellEditComplete:ce,showGridlines:"",scrollable:"",scrollHeight:"flex",size:"small"},{default:o(()=>[s(t(J),{frozen:"",alignFrozen:"left",field:"STT",header:"STT",style:{"min-width":"50px"},class:"frozen-column-emerald"},{body:o(e=>[l("div",lt,h(e.index),1)]),_:1}),L.value?(m(),y(t(J),{key:0,frozen:"",alignFrozen:"left",header:"In đơn",style:{"min-width":"64px"},class:"frozen-column-emerald"},{body:o(e=>[V.value[e.index]?(m(),y(t(I),{key:0,icon:"pi pi-print",size:"small",onClick:a=>ve(e.index)},null,8,["onClick"])):F("",!0)]),_:1})):F("",!0),s(t(J),{frozen:"",alignFrozen:"left",field:"Trạng thái",header:"Trạng thái",style:{"min-width":"120px"},class:"frozen-column-emerald"},{body:o(e=>[P.value?(m(),x("div",{key:0,class:He(["text-xs text-color",[p.value[e.index]?.status==="success"?"text-primary-600":"text-red-600"]])},h(p.value[e.index].message),3)):(m(),x("div",tt,"Chưa xác nhận"))]),_:1}),L.value?F("",!0):(m(),y(t(J),{key:1,frozen:"",alignFrozen:"left",field:"Dịch vụ",header:"Dịch vụ",style:{"min-width":"250px","font-size":"12px"},class:"frozen-column-emerald"},{body:o(e=>[l("span",null,h(d.value[e.index]?`${d.value[e.index].MA_DV_CHINH} - ${d.value[e.index].TEN_DICHVU}`:""),1)]),editor:o(({data:e,field:a,index:n})=>[s(t(G),{options:N.value[n],optionValue:"MA_DV_CHINH",optionLabel:"TEN_DICHVU",placeholder:"Chọn dịch vụ",size:"small",fluid:"","onUpdate:modelValue":_=>me(n,_)},null,8,["options","onUpdate:modelValue"])]),_:1})),L.value?F("",!0):(m(),y(t(J),{key:2,frozen:"",alignFrozen:"left",field:"Giá cước",header:"Giá cước",style:{"min-width":"100px"},class:"frozen-column-emerald"},{body:o(e=>[l("div",st,h(d.value[e.index]?t(te)(d.value[e.index].GIA_CUOC):""),1)]),_:1})),(m(!0),x(oe,null,Te(Object.entries(T),e=>(m(),y(t(J),{key:e[0],field:e[1],header:e[0],style:Le(se[e[1]])},{body:o(({data:a,field:n})=>[l("div",at,h(a[n]),1)]),editor:o(({data:a,field:n})=>[n==="PRODUCT_QUANTITY"||n==="PRODUCT_WEIGHT"||n==="PRODUCT_PRICE"||n==="MONEY_COLLECTION"?(m(),y(t(U),{key:0,modelValue:a[n],"onUpdate:modelValue":_=>a[n]=_,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):n==="PAYMENT_OBJECT"?(m(),y(t(G),{key:1,options:ae,optionLabel:"name",optionValue:"value",modelValue:a[n],"onUpdate:modelValue":_=>a[n]=_,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):n==="PRODUCT_TYPE"?(m(),y(t(G),{key:2,size:"small",options:w,optionLabel:"name",optionValue:"value",modelValue:a[n],"onUpdate:modelValue":_=>a[n]=_},null,8,["modelValue","onUpdate:modelValue"])):(m(),y(t(M),{key:3,modelValue:a[n],"onUpdate:modelValue":_=>a[n]=_,size:"small"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1},8,["field","header","style"]))),128))]),_:1},8,["value"])]),_:1})):F("",!0)]))}},it={__name:"index",setup(O){return(A,f)=>(m(),x("div",null,[s(t(Fe),{value:"1"},{default:o(()=>[s(t(je),null,{default:o(()=>[s(t(ge),{value:"1",as:"div",class:"flex items-center gap-1"},{default:o(()=>[...f[0]||(f[0]=[l("i",{class:"pi pi-file-check"},null,-1),he(" Đơn lẻ ",-1)])]),_:1}),s(t(ge),{value:"2",as:"div",class:"flex items-center gap-1"},{default:o(()=>[...f[1]||(f[1]=[l("i",{class:"pi pi-list-check"},null,-1),he(" Đơn excel ",-1)])]),_:1})]),_:1}),s(t(Be),{class:"mt-4"},{default:o(()=>[s(t(Oe),{value:"1"},{default:o(()=>[s(jl)]),_:1}),s(t(Oe),{value:"2"},{default:o(()=>[s(nt)]),_:1})]),_:1})]),_:1})]))}},It=Ne(it,[["__scopeId","data-v-f8410de7"]]);export{It as default};
