import{o as F,s as k,h as K,a as j}from"./schemas-DWI1EkU5.js";import"./index-Cl09ErUJ.js";import{r as p,X as Q,J as Y,c as y,o as u,a,e as V,j as _,w as n,b as e,L as l,y as N,A as W,F as Z,M as C,N as c,n as ee}from"./index-DR3HTC-0.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as M,a as se,b as q}from"./index-DqWCtRp4.js";import{b as L}from"./index-CeGrJY9f.js";import{a as X}from"./index-BXWYA0Hf.js";import{s as $}from"./index-BkB2nDAF.js";import{s as I}from"./index-3mynpBfV.js";import{s as H}from"./index-C56H-N6g.js";import{r as te,u as le,s as ae,a as oe,b as J,c as ie,d as G}from"./xlsx-BvH3saXK.js";import{d as ne}from"./helpers-ayDDXTdj.js";import"./index-i3OrTSJi.js";import"./index-C9xjTRud.js";import"./index-y7QF_bmf.js";const re={class:"flex items-center gap-8 py-4"},de={class:"flex items-center gap-1"},ce={class:"flex items-center gap-1"},ue={class:"flex flex-col gap-1 col-span-1"},pe={class:"flex flex-col gap-1 col-span-1"},me={class:"flex flex-col gap-1 col-span-1"},ve={class:"flex flex-col gap-1 col-span-3"},fe={class:"flex flex-col gap-1 col-span-1"},he={class:"flex flex-col gap-1 col-span-1"},xe={class:"flex flex-col gap-1 col-span-3"},ge={class:"flex items-center text-sm"},ye={class:"capitalize"},_e={class:"flex items-center text-sm mt-2"},be={class:"capitalize"},we={class:"flex items-center text-sm"},ke={__name:"AddressConvert",setup(U){const m=p([]),v=p([]),h=p([]),x=p("oldToNew"),b=p(!1),f=p(!1),w=p(null),g=p(null),A=()=>{w.value=null,g.value=null,f.value=!1},R=async()=>{try{const i=await C.get("/connector/viettelpost/provinces");i.data.success?m.value=i.data.data.data:c.error(i.data.message||"Lỗi khi lấy tỉnh/thành phố")}catch(i){c.error("Lỗi khi lấy tỉnh/thành phố"),console.error(i)}},D=async i=>{A();const s=m.value.find(t=>t.PROVINCE_NAME===i)?.PROVINCE_ID;if(!s){c.error("Không tìm thấy Id tỉnh");return}try{const t=await C.get("/connector/viettelpost/districts",{params:{provinceId:s}});t.data.success?v.value=t.data.data.data:c.error(t.data.message||"Lỗi khi lấy quận/huyện")}catch(t){c.error("Lỗi khi lấy quận/huyện"),console.error(t)}},O=async i=>{A();const s=v.value.find(t=>t.DISTRICT_NAME===i)?.DISTRICT_ID;if(!s){c.error("Không tìm thấy Id quận");return}try{const t=await C.get("/connector/viettelpost/wards",{params:{districtId:s}});t.data.success?h.value=t.data.data.data:c.error(t.data.message||"Lỗi khi lấy phường/xã")}catch(t){c.error("Lỗi khi lấy phường/xã"),console.error(t)}},P=async i=>{A();const s=m.value.find(t=>t.PROVINCE_NAME===i)?.PROVINCE_ID;if(!s){c.error("Không tìm thấy Id tỉnh");return}try{const t=await C.get("/connector/viettelpost/wards-new",{params:{provinceId:s}});t.data.success?h.value=t.data.data.data:c.error(t.data.message||"Lỗi khi lấy phường/xã")}catch(t){c.error("Lỗi khi lấy phường/xã"),console.error(t)}},d=F({province:k().min(1),district:k().min(1),ward:k().min(1),address:k().min(1)}),o=F({province:k().min(1),ward:k().min(1),address:k().min(1)}),r=Q(()=>x.value==="oldToNew"?K(d):K(o)),z=async i=>{if(!i.valid){c.error("Vui lòng nhập đầy đủ thông tin");return}b.value=!0;let s="";x.value==="oldToNew"?s=`${i.values.address}, ${i.values.ward}, ${i.values.district}, ${i.values.province}`:s=`${i.values.address}, ${i.values.ward}, ${i.values.province}`;try{const t=await C.post("/connector/viettelpost/checking-address",{address:s});t.data.success&&(g.value=t.data.data.reference.formattedAddress,w.value=s),f.value=!0,b.value=!1}catch(t){console.error(t),b.value=!1,f.value=!0}};return Y(()=>{R()}),(i,s)=>(u(),y(Z,null,[a(l(I),{class:"w-full mt-4"},{content:n(()=>[e("div",null,[s[4]||(s[4]=e("h2",null,"Phương thức chuyển đổi",-1)),e("div",re,[e("div",de,[a(l(M),{modelValue:x.value,"onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t),value:"oldToNew",size:"small"},null,8,["modelValue"]),s[2]||(s[2]=e("label",{class:"text-sm font-medium"},"Cũ sang mới",-1))]),e("div",ce,[a(l(M),{modelValue:x.value,"onUpdate:modelValue":s[1]||(s[1]=t=>x.value=t),value:"newToOld",size:"small"},null,8,["modelValue"]),s[3]||(s[3]=e("label",{class:"text-sm font-medium"},"Mới sang cũ",-1))])])]),x.value==="oldToNew"?(u(),V(l(j),{key:0,initialValues:{province:"",district:"",ward:"",address:""},resolver:r.value,onSubmit:z,class:"grid grid-cols-3 gap-x-2 gap-y-4"},{default:n(t=>[e("div",ue,[s[5]||(s[5]=e("label",{class:"text-sm font-medium"},"Tỉnh/Thành phố",-1)),a(l(L),{name:"province",onChange:T=>D(t.province.value),options:m.value,optionLabel:"PROVINCE_NAME",optionValue:"PROVINCE_NAME",size:"small"},null,8,["onChange","options"])]),e("div",pe,[s[6]||(s[6]=e("label",{class:"text-sm font-medium"},"Quận/Huyện",-1)),a(l(L),{name:"district",onChange:T=>O(t.district.value),options:v.value,optionLabel:"DISTRICT_NAME",optionValue:"DISTRICT_NAME",size:"small"},null,8,["onChange","options"])]),e("div",me,[s[7]||(s[7]=e("label",{class:"text-sm font-medium"},"Phường/Xã",-1)),a(l(L),{name:"ward",options:h.value,optionLabel:"WARDS_NAME",optionValue:"WARDS_NAME",size:"small"},null,8,["options"])]),e("div",ve,[s[8]||(s[8]=e("label",{class:"text-sm font-medium"},"Địa chỉ",-1)),a(l(X),{name:"address",size:"small"})]),a(l($),{type:"submit",label:"Chuyển đổi",icon:"pi pi-check",loading:b.value,size:"small"},null,8,["loading"])]),_:1},8,["resolver"])):_("",!0),x.value==="newToOld"?(u(),V(l(j),{key:1,initialValues:{province:"",ward:"",address:""},resolver:r.value,onSubmit:z,class:"grid grid-cols-2 gap-x-2 gap-y-4"},{default:n(t=>[e("div",fe,[s[9]||(s[9]=e("label",{class:"text-sm font-medium"},"Tỉnh/Thành phố",-1)),a(l(L),{name:"province",onChange:T=>P(t.province.value),options:m.value,optionLabel:"PROVINCE_NAME",optionValue:"PROVINCE_NAME",size:"small"},null,8,["onChange","options"])]),e("div",he,[s[10]||(s[10]=e("label",{class:"text-sm font-medium"},"Phường/Xã",-1)),a(l(L),{name:"ward",options:h.value,optionLabel:"WARDS_NAME",optionValue:"WARDS_NAME",size:"small"},null,8,["options"])]),e("div",xe,[s[11]||(s[11]=e("label",{class:"text-sm font-medium"},"Địa chỉ",-1)),a(l(X),{name:"address",size:"small"})]),a(l($),{type:"submit",label:"Chuyển đổi",icon:"pi pi-check",loading:b.value,size:"small"},null,8,["loading"])]),_:1},8,["resolver"])):_("",!0)]),_:1}),g.value&&f.value?(u(),V(l(I),{key:0,class:"mt-4 p-4 bg-green-200 result-card-success"},{header:n(()=>[...s[12]||(s[12]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-check-circle text-green-900"}),e("h2",{class:"text-green-900 font-bold text-xl"},"Kết quả")],-1)])]),content:n(()=>[e("div",ge,[s[13]||(s[13]=e("span",{class:"font-bold block w-32"},"Địa chỉ gốc:",-1)),e("span",ye,N(w.value),1)]),e("div",_e,[s[14]||(s[14]=e("span",{class:"font-bold block w-32"},"Địa chỉ chuyển đổi:",-1)),e("span",be,N(g.value),1)])]),_:1})):_("",!0),!g.value&&f.value?(u(),V(l(I),{key:1,class:"mt-4 p-4 result-card-failure"},{header:n(()=>[...s[15]||(s[15]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-times-circle text-red-900"}),e("h2",{class:"text-red-900 font-bold text-xl"},"Kết quả")],-1)])]),content:n(()=>[e("div",we,[a(l(H),{severity:"error",icon:"pi pi-ban",size:"small"},{default:n(()=>[...s[16]||(s[16]=[W("Đã có lỗi xảy ra",-1)])]),_:1})])]),_:1})):_("",!0)],64))}},Ae=B(ke,[["__scopeId","data-v-19293057"]]),Ce={class:"flex items-center gap-8 py-4"},Ve={class:"flex items-center gap-1"},Ne={class:"flex items-center gap-1"},$e={key:0},Ie={class:"flex items-end gap-1 w-full"},ze={class:"flex flex-col gap-1 flex-1"},Te={class:"flex items-center text-sm mt-2"},Ee={class:"capitalize"},Se={class:"flex items-center text-sm"},Le={key:1},Me={class:"flex items-end gap-4 justify-between"},Re={class:"flex items-end"},De={class:"flex items-center gap-1 text-sm"},Oe={class:"flex items-center gap-4 justify-end"},Pe={key:0,class:"mt-2"},qe={class:"text-sm"},Fe={key:0},Ke={key:0,class:"pi pi-times text-red-500 mr-2 mt-1",size:"small"},je={key:1,class:"pi pi-check-circle text-green-700 mr-2 mt-1",size:"small"},We={key:1},Xe={class:"py-4 flex justify-end items-center"},Be={__name:"AddressVerify",setup(U){const m=p(!1),v=K(F({address:k().min(1)})),h=p("single"),x=p(null),b=p(""),f=p(null),w=p([]),g=p(null),A=p(!1),R=async d=>{if(!d.valid){c.error("Vui lòng nhập đầy đủ thông tin");return}m.value=!0;try{const o=await C.post("/connector/viettelpost/checking-address",{address:d.values.address});o.data.success?(g.value=o.data.data?.formattedAddress,A.value=!0):c.error(o.data.message||"Địa chỉ không hợp lệ")}catch(o){c.error("Địa chỉ không hợp lệ"),console.error(o)}finally{m.value=!1}},D=d=>{if(f.value=d.target.files[0],b.value=d.target.files[0].name,!f.value)return;const o=new FileReader;o.onload=r=>{const z=new Uint8Array(r.target.result),i=te(z,{type:"array"}),s=i.SheetNames[0],t=i.Sheets[s];le.sheet_to_json(t).map((E,S)=>{E.address&&w.value.push({index:S+1,address:E.address,verifiedAddress:""})})},o.readAsArrayBuffer(f.value)},O=async()=>{if(!f.value){c.error("Vui lòng chọn file");return}m.value=!0;const d=2,o=ne(w.value,d);for(let r=0;r<o.length;r++){const i=o[r].map((t,T)=>{const E=r*d+T;return C.post("/connector/viettelpost/checking-address",{address:t.address}).then(S=>({idx:E,res:S})).catch(S=>{throw{idx:E,err:S}})});(await Promise.allSettled(i)).forEach(t=>{t.status==="fulfilled"?w.value[t.value.idx].verifiedAddress=t.value.res.data?.data?.formattedAddress||"Lỗi":console.log(t.value)})}m.value=!1},P=()=>{const d=document.createElement("a");d.href="/docs/addresses.xlsx",d.download="addresses.xlsx",document.body.appendChild(d),d.click(),document.body.removeChild(d)};return(d,o)=>(u(),V(l(I),{class:"w-full mt-4"},{content:n(()=>[e("div",Ce,[e("div",Ve,[a(l(M),{modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=r=>h.value=r),value:"single",size:"small"},null,8,["modelValue"]),o[3]||(o[3]=e("label",{for:"",class:"text-sm text-color font-medium"},"Địa chỉ đơn lẻ",-1))]),e("div",Ne,[a(l(M),{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=r=>h.value=r),value:"batch",size:"small"},null,8,["modelValue"]),o[4]||(o[4]=e("label",{for:"",class:"text-sm text-color font-medium"},"Địa chỉ hàng loạt",-1))])]),h.value==="single"?(u(),y("div",$e,[a(l(j),{initialValues:{address:""},resolver:l(v),onSubmit:R},{default:n(r=>[e("div",Ie,[e("div",ze,[o[5]||(o[5]=e("label",{class:"text-sm font-medium"},"Địa chỉ",-1)),a(l(X),{name:"address",class:"w-full",size:"small"})]),a(l($),{type:"submit",label:"Xác minh",icon:"pi pi-check",loading:m.value,size:"small"},null,8,["loading"])])]),_:1},8,["resolver"]),g.value&&A.value?(u(),V(l(I),{key:0,class:"mt-4 p-4 bg-green-200 result-card-success"},{header:n(()=>[...o[6]||(o[6]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-check-circle text-green-900"}),e("h2",{class:"text-green-900 font-bold text-xl"},"Kết quả")],-1)])]),content:n(()=>[e("div",Te,[e("span",Ee,N(g.value),1)])]),_:1})):_("",!0),!g.value&&A.value?(u(),V(l(I),{key:1,class:"mt-4 p-4 result-card-failure"},{header:n(()=>[...o[7]||(o[7]=[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-times-circle text-red-900"}),e("h2",{class:"text-red-900 font-bold text-xl"},"Kết quả")],-1)])]),content:n(()=>[e("div",Se,[a(l(H),{severity:"error",icon:"pi pi-ban",size:"small"},{default:n(()=>[...o[8]||(o[8]=[W("Đã có lỗi xảy ra",-1)])]),_:1})])]),_:1})):_("",!0)])):_("",!0),h.value==="batch"?(u(),y("div",Le,[e("div",Me,[e("div",Re,[e("span",De,[o[9]||(o[9]=e("i",{class:"pi pi-file text-primary"},null,-1)),W(N(b.value),1)])]),e("div",Oe,[e("input",{ref_key:"fileChooser",ref:x,type:"file",name:"file",id:"fileChooser",hidden:"",onChange:D},null,544),a(l($),{type:"button",label:"Chọn file",size:"small",icon:"pi pi-upload",onClick:o[2]||(o[2]=r=>x.value.click())}),a(l($),{icon:"pi pi-download",label:"File mẫu",variant:"outlined",severity:"info",size:"small",onClick:P})])]),f.value?(u(),y("div",Pe,[a(l(se),{value:w.value,responsiveLayout:"scroll",showGridlines:""},{default:n(()=>[a(l(q),{field:"index",header:"STT",style:{"text-align":"center",padding:"1rem"}}),a(l(q),{field:"address",header:"Địa chỉ",style:{width:"50%",padding:"1rem"}},{body:n(r=>[e("span",qe,N(r.data.address),1)]),_:1}),a(l(q),{field:"verifiedAddress",header:"Địa chỉ đã xác minh",style:{width:"50%",padding:"1rem"}},{body:n(r=>[r.data.verifiedAddress.length?(u(),y("div",Fe,[r.data.verifiedAddress==="Lỗi"?(u(),y("i",Ke)):(u(),y("i",je)),e("span",{class:ee(["text-sm text-color",[r.data.verifiedAddress==="Lỗi"?"text-red-500":"text-green-700"]])},N(r.data.verifiedAddress),3)])):(u(),y("div",We))]),_:1})]),_:1},8,["value"]),e("div",Xe,[a(l($),{onClick:O,type:"button",label:"Xác minh",icon:"pi pi-check",loading:m.value,size:"small"},null,8,["loading"])])])):_("",!0)])):_("",!0)]),_:1}))}},Ue=B(Be,[["__scopeId","data-v-638f33c0"]]),Je={class:"h-full p-4 flex flex-col gap-2 overflow-auto"},Ge={__name:"index",setup(U){return(m,v)=>(u(),y("div",Je,[v[2]||(v[2]=e("div",{class:"flex flex-col gap-2"},[e("h1",{class:"text-2xl font-bold text-color"},"Tiện ích địa chỉ"),e("span",{class:"text-muted-color text-sm"},"Chuyển đổi và xác minh địa chỉ")],-1)),a(l(ae),{value:"1",class:"flex flex-1 my-tab"},{default:n(()=>[a(l(oe),null,{default:n(()=>[a(l(J),{value:"1"},{default:n(()=>[...v[0]||(v[0]=[e("div",{class:"flex item-center gap-2"},[e("i",{class:"pi pi-arrow-right-arrow-left mt-1"}),e("span",{class:"text-sm"},"Chuyển đổi địa chỉ")],-1)])]),_:1}),a(l(J),{value:"2"},{default:n(()=>[...v[1]||(v[1]=[e("div",{class:"flex item-center gap-2"},[e("i",{class:"pi pi-map-marker mt-1"}),e("span",{class:"text-sm"},"Xác minh địa chỉ")],-1)])]),_:1})]),_:1}),a(l(ie),{class:"flex flex-1"},{default:n(()=>[a(l(G),{value:"1",class:"w-full"},{default:n(()=>[a(Ae)]),_:1}),a(l(G),{value:"2",class:"w-full"},{default:n(()=>[a(Ue)]),_:1})]),_:1})]),_:1})]))}},us=B(Ge,[["__scopeId","data-v-ba136978"]]);export{us as default};
