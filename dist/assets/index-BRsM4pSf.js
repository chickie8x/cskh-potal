import{s as ye}from"./index-BraZoT5L.js";import"./index-CrBVI4KK.js";import{B as Ue,Z as xe,c as V,o as v,k as Ae,m as Se,r as p,V as se,J as Oe,U as Pe,$ as Ve,L as ne,M as He,a as s,w as r,b as t,N as e,A as W,y as d,j as B,F as ce,q as De,P as Q,R as A,e as U,n as Le,p as we}from"./index-C-7RJgkn.js";import{f as ae,c as ze,r as Me,u as ke,d as ge}from"./helpers-Dl54-pCf.js";import{h as $e,o as Ye,n as de,s as N}from"./schemas-DgDhmXQR.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Y}from"./index-CA8W0Dso.js";import{e as Ge,c as Z,d as X,a as w}from"./index-C3KlkN14.js";import{b as G}from"./index-CUnwFEp1.js";import{s as M}from"./index-Do-tyw5i.js";import{b as le,s as We,a as K}from"./index-CPPwAHJ5.js";import{s as P}from"./index-DF9WDu2i.js";import{s as S}from"./index-B9rXqS8S.js";import{s as Fe}from"./index-md5hE0pG.js";import{s as je}from"./index-BwXpCwBF.js";import{s as Be}from"./index-D9PktcSU.js";import{s as Qe,a as Je,b as Ne,c as qe,d as Ie}from"./index-DmMaV04l.js";import"./index-BI2ldBAY.js";import"./index-DQfmIj7h.js";import"./index-DEra56ZM.js";import"./index-C9Yn04yt.js";var Ke=`
    .p-radiobutton-group {
        display: inline-flex;
    }
`,Ze={root:"p-radiobutton-group p-component"},Xe=Ue.extend({name:"radiobuttongroup",style:Ke,classes:Ze}),et={name:"BaseRadioButtonGroup",extends:Ge,style:Xe,provide:function(){return{$pcRadioButtonGroup:this,$parentInstance:this}}},ue={name:"RadioButtonGroup",extends:et,inheritAttrs:!1,data:function(){return{groupName:this.name}},watch:{name:function(i){this.groupName=i||xe("radiobutton-group-")}},mounted:function(){this.groupName=this.groupName||xe("radiobutton-group-")}};function tt(I,i,O,b,F,_){return v(),V("div",Se({class:I.cx("root")},I.ptmi("root")),[Ae(I.$slots,"default")],16)}ue.render=tt;const lt={__name:"index",props:{form:Object},emits:["allFieldsHaveValue"],setup(I,{emit:i}){const O=I,b=i,F=["SENDER_ADDRESS","SENDER_FULLNAME","SENDER_PHONE","RECEIVER_FULLNAME","RECEIVER_PHONE","RECEIVER_PROVINCE","RECEIVER_DISTRICT","RECEIVER_WARD","RECEIVER_ADDR","PRODUCT_TYPE","PRODUCT_WEIGHT"],_=["SENDER_ADDRESS","PRODUCT_TYPE","PRODUCT_PRICE","PRODUCT_WEIGHT","PRODUCT_LENGTH","PRODUCT_WIDTH","PRODUCT_HEIGHT","TYPE","MONEY_COLLECTION"],x=p({});se(()=>F.map(h=>O.form[h]?.value),h=>{h.every(C=>C&&C!=="")&&z()},{deep:!0});function z(){_.map(R=>{x.value[R]=O.form[R]?.value});const h=`${O.form.RECEIVER_ADDR?.value}, ${O.form.RECEIVER_WARD?.value}, ${O.form.RECEIVER_DISTRICT?.value}, ${O.form.RECEIVER_PROVINCE?.value}`;x.value.RECEIVER_ADDRESS=h,x.value.TYPE=1,b("allFieldsHaveValue",x.value)}return(h,R)=>null}},st={class:"flex gap-8 pb-4"},at={class:"flex flex-col gap-4 w-3/5"},nt={class:"flex items-center gap-1"},ot={class:"text-sm text-color font-bold"},it={class:"flex flex-col gap-4"},rt={class:"flex flex-col gap-2 py-2"},dt={class:"flex items-center gap-8"},ct={class:"text-sm font-semibold text-color"},ut={class:"text-sm font-semibold text-color"},_t={class:"text-sm text-color"},mt={class:"flex items-center gap-1"},pt={class:"text-sm text-color font-bold"},Et={class:"flex flex-col gap-4"},vt={class:"flex items-center gap-2"},Rt={class:"flex items-center gap-2"},ft={class:"flex items-center gap-1"},ht={class:"text-sm text-color font-bold"},Ct={class:"grid grid-cols-3 gap-8 text-sm text-color"},Tt=["for"],Dt={key:0,class:"mt-4 border-t border-surface flex items-center gap-12 pt-4 text-sm text-color"},Ot={class:"flex items-center gap-2"},xt={class:"font-bold text-red-500"},gt={class:"flex items-center gap-2"},Nt={class:"font-bold text-red-500"},It={class:"flex items-center gap-2"},Pt={class:"font-bold text-red-500"},Vt={class:"flex flex-col gap-4 w-2/5"},bt={class:"flex items-center gap-2"},yt={class:"text-sm text-color font-bold"},Ut={class:"flex flex-col gap-3"},At={class:"flex flex-col gap-2 mt-4"},St={class:"text-sm text-color font-medium"},Ht={class:"flex items-center gap-2"},Lt={for:"typeHH",class:"text-sm text-color"},wt={class:"flex items-center gap-2"},zt={for:"typeTH",class:"text-sm text-color"},Mt={class:"mt-2 border-t border-surface py-4 flex flex-col divide-y divide-dashed divide-surface-300"},kt={class:"flex items-center gap-4"},$t={for:"productName"},Yt={class:"flex items-center gap-2 mt-4"},Gt={for:"productQuantity"},Wt={for:"productWeight"},Ft={for:"productPrice"},jt={class:"flex items-center justify-end py-4"},Bt={class:"py-4 flex flex-col gap-2"},Qt={class:"flex items-center gap-1"},Jt={class:"text-sm text-color font-medium"},qt={class:"grid grid-cols-3 gap-2"},Kt={for:"productLength"},Zt={for:"productWidth"},Xt={for:"productHeight"},el={class:"mt-4 border-t border-surface py-4"},tl={class:"flex items-center justify-between"},ll={class:"text-sm font-medium text-color"},sl={class:"text-sm font-semibold text-red-600"},al={class:"flex items-center justify-between"},nl={class:"text-sm font-medium text-color"},ol={class:"text-sm font-semibold text-red-600"},il={class:"flex items-center gap-2"},rl={class:"text-color font-bold text-sm"},dl={class:"flex items-center gap-2"},cl={for:"isCod",class:"text-sm"},ul={class:"flex flex-col gap-2 mt-4"},_l={class:"text-sm text-color font-medium"},ml={class:"flex items-center gap-1"},pl={for:"senderPay",class:"text-sm"},El={class:"flex items-center gap-1"},vl={for:"receiverPay",class:"text-sm"},Rl={class:"mt-4"},fl={for:"ORDER_NOTE"},hl={class:"grid grid-cols-4 gap-2 text-sm text-color"},Cl={class:"flex items-center gap-2"},Tl={class:"font-medium"},Dl={class:"font-bold text-red-500"},Ol={class:"flex items-center gap-2"},xl={class:"font-medium"},gl={class:"font-bold text-red-500"},Nl={class:"flex items-center gap-2"},Il={class:"font-medium"},Pl={class:"font-bold text-red-500"},Vl={class:"flex items-center gap-2"},bl={class:"flex items-center justify-between gap-2"},yl={__name:"SingleOrderCreate",setup(I){const{t:i}=Oe(),O=Pe(),b=$e(Ye({SENDER_ADDRESS:N().min(1,"Địa chỉ người gửi là bắt buộc"),SENDER_FULLNAME:N().min(1,"Tên người gửi là bắt buộc"),SENDER_PHONE:N().min(1,"Số điện thoại người gửi là bắt buộc"),RECEIVER_FULLNAME:N().min(1,"Tên người nhận là bắt buộc"),RECEIVER_PHONE:N().min(1,"Số điện thoại người nhận là bắt buộc"),RECEIVER_ADDRESS:N().min(1,"Địa chỉ người nhận là bắt buộc"),RECEIVER_WARD:N().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_DISTRICT:N().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_PROVINCE:N().min(1,"Quận huyện người nhận là bắt buộc"),RECEIVER_ADDR:N().min(1,"Địa chỉ người nhận là bắt buộc"),PRODUCT_TYPE:N().min(1),PRODUCT_PRICE:de(),PRODUCT_WEIGHT:de(),ORDER_SERVICE:N().min(1),ORDER_PAYMENT:de(),ORDER_NOTE:N().optional(),MONEY_COLLECTION:de().optional()})),F=Ve(),_=p(null),x=p(!1),z=F.userAddress,h=p(z[0]),R=p([]),C=p([]),k=p([]),y=p(!1),H=p([]),T=p(H.value[0]||null),oe=p({}),ie=ne(()=>y.value?_.value?.states.WHO_PAY.value==="senderPay"?3:2:_.value?.states.WHO_PAY.value==="senderPay"?1:4),L=p([{PRODUCT_NAME:"",PRODUCT_QUANTITY:1,PRODUCT_WEIGHT:null,PRODUCT_PRICE:null}]),ee=ne(()=>L.value.reduce((o,l)=>{const n=Number(l.PRODUCT_WEIGHT);return o+(isNaN(n)?0:n)},0)),$=ne(()=>L.value.reduce((o,l)=>{const n=Number(l.PRODUCT_PRICE);return o+(isNaN(n)?0:n)},0)),J=()=>{L.value.push({PRODUCT_NAME:"",PRODUCT_QUANTITY:1,PRODUCT_WEIGHT:null,PRODUCT_PRICE:null})},q=o=>{if(L.value.length>1)L.value.splice(o,1);else return},f=async()=>{try{const o=await Q.get("/connector/viettelpost/provinces");o.data.success?R.value=o.data.data.data:A.error(o.data.message||"Lỗi khi lấy tỉnh/thành phố")}catch(o){A.error("Lỗi khi lấy tỉnh/thành phố"),console.error(o)}},_e=async o=>{const l=R.value.find(n=>n.PROVINCE_NAME===o)?.PROVINCE_ID;if(!l){A.error("Không tìm thấy Id tỉnh");return}try{const n=await Q.get("/connector/viettelpost/districts",{params:{provinceId:l}});n.data.success?C.value=n.data.data.data:A.error(n.data.message||"Lỗi khi lấy quận/huyện")}catch(n){A.error("Lỗi khi lấy quận/huyện"),console.error(n)}},me=async o=>{const l=C.value.find(n=>n.DISTRICT_NAME===o)?.DISTRICT_ID;if(!l){A.error("Không tìm thấy Id quận");return}try{const n=await Q.get("/connector/viettelpost/wards",{params:{districtId:l}});n.data.success?k.value=n.data.data.data:A.error(n.data.message||"Lỗi khi lấy phường/xã")}catch(n){A.error("Lỗi khi lấy phường/xã"),console.error(n)}};se($,()=>{_.value.setFieldValue("PRODUCT_PRICE",$.value)}),se(ee,()=>{_.value.setFieldValue("PRODUCT_WEIGHT",ee.value)}),se(y,()=>{_.value.setFieldValue("MONEY_COLLECTION",y.value?$.value:void 0)}),se(ie,()=>{_.value.setFieldValue("ORDER_PAYMENT",ie.value)});const pe=async o=>{try{const l=await Q.post("/connector/viettelpost/price-all-nlp",{data:o});l.data.success&&(H.value=l.data.data.RESULT,T.value=H.value[0],_.value.setFieldValue("ORDER_SERVICE",T.value.MA_DV_CHINH),_.value.setFieldValue("RECEIVER_ADDRESS",l.data.data.RECEIVER_ADDRESS.ADDRESS))}catch(l){console.error(l)}},Ee=o=>{T.value=H.value.find(l=>l.MA_DV_CHINH===o.target.value)},ve=["SENDER_FULLNAME","SENDER_ADDRESS","SENDER_PHONE","RECEIVER_FULLNAME","RECEIVER_ADDRESS","RECEIVER_PHONE","PRODUCT_PRICE","PRODUCT_WEIGHT","PRODUCT_LENGTH","PRODUCT_WIDTH","PRODUCT_HEIGHT","ORDER_PAYMENT","ORDER_SERVICE","PRODUCT_TYPE","ORDER_SERVICE_ADD","ORDER_NOTE","MONEY_COLLECTION"],Re=async o=>{if(!o.valid){console.log(o.errors),A.error("Thiếu hoặc sai thông tin");return}const l={};ve.map(a=>{l[a]=o.values[a]}),l.PRODUCT_DETAIL=L.value;const n=L.value.map(a=>a.PRODUCT_NAME).join(",");l.PRODUCT_NAME=n;try{const a=await Q.post("/connector/viettelpost/order/create-nlp",{data:l});console.log(a.data),x.value=!0,oe.value=a.data.data}catch(a){A.error(a.response.data.message||"Lỗi khi tạo đơn hàng"),console.error(a)}},fe=()=>{O.push(`/print-order/viettelpost?ordercode=${oe.value.waybill}`)},he=()=>{O.push("/")},Ce=()=>{x.value=!1},u=(o,l)=>{const n=l.value,a=z.find(E=>E.address===n);a&&(h.value=a,_.value.setFieldValue("SENDER_FULLNAME",a.addressName),_.value.setFieldValue("SENDER_PHONE",a.addressPhone))};return He(()=>{f()}),(o,l)=>(v(),V(ce,null,[s(e(ye),{ref_key:"formRef",ref:_,initialValues:{SENDER_FULLNAME:h.value.addressName,SENDER_PHONE:h.value.addressPhone,SENDER_ADDRESS:h.value.address,RECEIVER_FULLNAME:"",RECEIVER_PHONE:"",RECEIVER_PROVINCE:"",RECEIVER_DISTRICT:"",RECEIVER_WARD:"",RECEIVER_ADDR:"",RECEIVER_ADDRESS:"",PRODUCT_TYPE:"HH",PRODUCT_PRICE:0,PRODUCT_WEIGHT:0,PRODUCT_LENGTH:1,PRODUCT_WIDTH:1,PRODUCT_HEIGHT:1,ORDER_PAYMENT:null,MONEY_COLLECTION:void 0,ORDER_SERVICE:null,ORDER_NOTE:"",WHO_PAY:"senderPay"},resolver:e(b),class:"relative",onSubmit:Re},{default:r(n=>[t("div",st,[t("div",at,[s(e(Y),null,{title:r(()=>[t("div",nt,[l[2]||(l[2]=t("i",{class:"pi pi-user size-5"},null,-1)),t("span",ot,d(e(i)("sender")),1)])]),content:r(()=>[t("div",it,[s(e(Z),null,{default:r(()=>[s(e(X),{class:"pi pi-user"}),s(e(w),{name:"SENDER_FULLNAME",class:"w-full",size:"small",readonly:""})]),_:1}),s(e(Z),null,{default:r(()=>[s(e(X),{class:"pi pi-phone"}),s(e(w),{name:"SENDER_PHONE",class:"w-full",size:"small",readonly:""})]),_:1}),s(e(G),{name:"SENDER_ADDRESS",options:e(z),optionValue:"address",optionLabel:"address",class:"w-full",size:"small",checkmark:"",onChange:a=>u(n,a)},{option:r(a=>[t("div",rt,[t("div",dt,[t("span",ct,[l[3]||(l[3]=t("i",{class:"pi pi-warehouse size-4 mr-1"},null,-1)),W(d(a.option.addressName),1)]),t("span",ut,[l[4]||(l[4]=t("i",{class:"pi pi-phone size-4 mr-1"},null,-1)),W(d(a.option.addressPhone),1)])]),t("span",_t,[l[5]||(l[5]=t("i",{class:"pi pi-map-marker size-4 mr-1"},null,-1)),W(d(a.option.address),1)])])]),_:1},8,["options","onChange"])])]),_:2},1024),s(e(Y),null,{title:r(()=>[t("div",mt,[l[6]||(l[6]=t("i",{class:"pi pi-user size-5"},null,-1)),t("span",pt,d(e(i)("receiver")),1)])]),content:r(()=>[t("div",Et,[t("div",vt,[s(e(Z),{class:"w-full"},{default:r(()=>[s(e(X),{class:"pi pi-user"}),s(e(w),{name:"RECEIVER_FULLNAME",placeholder:e(i)("receiverName"),class:"w-full",size:"small"},null,8,["placeholder"])]),_:1}),s(e(Z),{class:"w-full"},{default:r(()=>[s(e(X),{class:"pi pi-phone"}),s(e(w),{name:"RECEIVER_PHONE",placeholder:e(i)("receiverPhone"),class:"w-full",size:"small"},null,8,["placeholder"])]),_:1})]),t("div",Rt,[s(e(G),{name:"RECEIVER_PROVINCE",options:R.value,optionValue:"PROVINCE_NAME",optionLabel:"PROVINCE_NAME",placeholder:e(i)("receiverProvince"),class:"w-full",size:"small",onChange:a=>_e(n.RECEIVER_PROVINCE.value),filter:""},null,8,["options","placeholder","onChange"]),s(e(G),{name:"RECEIVER_DISTRICT",options:C.value,optionValue:"DISTRICT_NAME",optionLabel:"DISTRICT_NAME",placeholder:e(i)("receiverDistrict"),class:"w-full",size:"small",onChange:a=>me(n.RECEIVER_DISTRICT.value),filter:""},null,8,["options","placeholder","onChange"]),s(e(G),{name:"RECEIVER_WARD",options:k.value,optionValue:"WARDS_NAME",optionLabel:"WARDS_NAME",placeholder:e(i)("receiverWard"),class:"w-full",size:"small",filter:""},null,8,["options","placeholder"])]),s(e(M),{variant:"on"},{default:r(()=>[s(e(w),{name:"RECEIVER_ADDR",class:"w-full",size:"small"}),l[7]||(l[7]=t("label",{for:"RECEIVER_ADDR"},"Địa chỉ",-1))]),_:1}),s(e(w),{name:"RECEIVER_ADDRESS",class:"hidden"})])]),_:2},1024),s(e(Y),null,{title:r(()=>[t("div",ft,[l[8]||(l[8]=t("i",{class:"pi pi-truck"},null,-1)),t("span",ht,d(e(i)("service")),1)])]),content:r(()=>[s(e(ue),{name:"ORDER_SERVICE",onChange:Ee},{default:r(()=>[t("div",Ct,[(v(!0),V(ce,null,De(H.value,a=>(v(),V("div",{key:a.MA_DV_CHINH,class:"flex items-center gap-2"},[s(e(le),{id:a.MA_DV_CHINH,value:a.MA_DV_CHINH,size:"small"},null,8,["id","value"]),t("label",{for:a.MA_DV_CHINH},d(a.TEN_DICHVU),9,Tt)]))),128))])]),_:1}),T.value?(v(),V("div",Dt,[t("div",Ot,[l[9]||(l[9]=t("span",{class:"font-medium"}," Mã dịch vụ: ",-1)),t("span",xt,d(T.value?.MA_DV_CHINH),1)]),t("div",gt,[l[10]||(l[10]=t("span",{class:"font-medium"}," Giá cước: ",-1)),t("span",Nt,d(T.value?.GIA_CUOC?e(ae)(T.value?.GIA_CUOC):null),1)]),t("div",It,[l[11]||(l[11]=t("span",{class:"font-medium"}," Thời gian dự kiến: ",-1)),t("span",Pt,d(T.value?.THOI_GIAN||null),1)])])):B("",!0)]),_:1})]),t("div",Vt,[s(e(Y),null,{title:r(()=>[t("div",bt,[l[12]||(l[12]=t("i",{class:"pi pi-shopping-cart"},null,-1)),t("span",yt,d(e(i)("productInfo")),1)])]),content:r(()=>[t("div",Ut,[t("div",At,[t("span",St,d(e(i)("productType")),1),s(e(ue),{name:"PRODUCT_TYPE",class:"flex items-center gap-12"},{default:r(()=>[t("div",Ht,[s(e(le),{value:"HH",inputId:"typeHH",size:"small",checked:""}),t("label",Lt,d(e(i)("package")),1)]),t("div",wt,[s(e(le),{value:"TH",inputId:"typeTH",size:"small"}),t("label",zt,d(e(i)("document")),1)])]),_:1})]),t("div",Mt,[(v(!0),V(ce,null,De(L.value,(a,E)=>(v(),V("div",{key:E,class:"py-4"},[t("div",kt,[s(e(M),{variant:"on"},{default:r(()=>[s(e(w),{id:"productName",modelValue:a.PRODUCT_NAME,"onUpdate:modelValue":m=>a.PRODUCT_NAME=m,size:"small",fluid:""},null,8,["modelValue","onUpdate:modelValue"]),t("label",$t,d(e(i)("productName")),1)]),_:2},1024),s(e(P),{onClick:m=>q(E),variant:"outlined",icon:"pi pi-trash",size:"small",severity:"danger"},null,8,["onClick"])]),t("div",Yt,[s(e(M),{variant:"on"},{default:r(()=>[s(e(S),{id:"productQuantity",modelValue:a.PRODUCT_QUANTITY,"onUpdate:modelValue":m=>a.PRODUCT_QUANTITY=m,size:"small",fluid:"",class:"text-sm",mode:"decimal",showButtons:""},null,8,["modelValue","onUpdate:modelValue"]),t("label",Gt,d(e(i)("productQuantity")),1)]),_:2},1024),s(e(M),{variant:"on"},{default:r(()=>[s(e(S),{id:"productWeight",modelValue:a.PRODUCT_WEIGHT,"onUpdate:modelValue":m=>a.PRODUCT_WEIGHT=m,size:"small",fluid:"",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]),t("label",Wt,d(e(i)("productWeight")),1)]),_:2},1024),s(e(M),{variant:"on"},{default:r(()=>[s(e(S),{id:"productPrice",modelValue:a.PRODUCT_PRICE,"onUpdate:modelValue":m=>a.PRODUCT_PRICE=m,size:"small",fluid:"",class:"text-sm"},null,8,["modelValue","onUpdate:modelValue"]),t("label",Ft,d(e(i)("productPrice")),1)]),_:2},1024)])]))),128)),t("div",jt,[s(e(P),{onClick:J,variant:"outlined",label:"Thêm",icon:"pi pi-plus",size:"small"})]),t("div",Bt,[t("div",Qt,[l[13]||(l[13]=t("i",{class:"pi pi-info-circle size-5"},null,-1)),t("span",Jt,d(e(i)("productSize")),1)]),t("div",qt,[s(e(M),{variant:"on"},{default:r(()=>[s(e(S),{id:"productLength",name:"PRODUCT_LENGTH",size:"small",fluid:"",format:!1}),t("label",Kt,d(e(i)("productLength")),1)]),_:1}),s(e(M),{variant:"on"},{default:r(()=>[s(e(S),{id:"productWidth",name:"PRODUCT_WIDTH",size:"small",fluid:"",format:!1}),t("label",Zt,d(e(i)("productWidth")),1)]),_:1}),s(e(M),{variant:"on"},{default:r(()=>[s(e(S),{id:"productHeight",name:"PRODUCT_HEIGHT",size:"small",fluid:"",format:!1}),t("label",Xt,d(e(i)("productHeight")),1)]),_:1})])]),t("div",el,[t("div",tl,[t("span",ll,d(e(i)("totalWeight")),1),t("span",sl,d(e(ze)(ee.value))+"g",1)]),t("div",al,[t("span",nl,d(e(i)("totalPrice")),1),t("span",ol,d(e(ae)($.value)),1)]),s(e(S),{id:"productPrice",name:"PRODUCT_PRICE",size:"small",class:"hidden!",readonly:""}),s(e(S),{id:"productWeight",name:"PRODUCT_WEIGHT",size:"small",class:"hidden!",readonly:""}),s(e(S),{id:"orderPayment",name:"ORDER_PAYMENT",size:"small",class:"hidden!",readonly:""})])])])]),_:1}),s(e(Y),null,{title:r(()=>[t("div",il,[l[14]||(l[14]=t("i",{class:"pi pi-money-bill size-5"},null,-1)),t("span",rl,d(e(i)("codMethod")),1)])]),content:r(()=>[t("div",dl,[s(e(Fe),{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),id:"isCod",name:"isCod",size:"small",binary:""},null,8,["modelValue"]),t("label",cl,d(e(i)("codByProductPrice")),1)]),s(e(S),{modelValue:y.value?$.value:0,id:"codAmount",name:"MONEY_COLLECTION",size:"small",fluid:"",readonly:"",suffix:" VNĐ",class:"mt-2"},null,8,["modelValue"]),t("div",ul,[t("span",_l,d(e(i)("whoPay")),1),s(e(ue),{name:"WHO_PAY",class:"flex items-center gap-8"},{default:r(()=>[t("div",ml,[s(e(le),{id:"senderPay",value:"senderPay",size:"small"}),t("label",pl,d(e(i)("sender")),1)]),t("div",El,[s(e(le),{id:"receiverPay",value:"receiverPay",size:"small"}),t("label",vl,d(e(i)("receiver")),1)])]),_:1})]),t("div",Rl,[s(e(M),{variant:"on"},{default:r(()=>[s(e(je),{name:"ORDER_NOTE",fluid:"",class:"text-sm"}),t("label",fl,d(e(i)("note")),1)]),_:1})])]),_:1})])]),s(lt,{form:n,onAllFieldsHaveValue:pe},null,8,["form"]),s(e(Y),{class:"myDock"},{content:r(()=>[t("div",hl,[t("div",Cl,[t("span",Tl,d(e(i)("totalFee"))+": ",1),t("span",Dl,d(T.value?.GIA_CUOC?e(ae)(T.value?.GIA_CUOC):0),1)]),t("div",Ol,[t("span",xl,d(e(i)("timeDiliver"))+": ",1),t("span",gl,d(T.value?.THOI_GIAN||0),1)]),t("div",Nl,[t("span",Il,d(e(i)("codMoney"))+": ",1),t("span",Pl,d(_.value?.states.MONEY_COLLECTION.value?e(ae)(_.value?.states.MONEY_COLLECTION.value):0),1)]),t("div",Vl,[s(e(P),{type:"submit",label:e(i)("createOrder"),icon:"pi pi-check",size:"small"},null,8,["label"]),s(e(P),{variant:"outlined",severity:"info",label:e(i)("saveDraft"),icon:"pi pi-file",size:"small"},null,8,["label"])])])]),_:1})]),_:1},8,["initialValues","resolver"]),s(e(Be),{visible:x.value,"onUpdate:visible":l[1]||(l[1]=n=>x.value=n),modal:"",header:"Tạo đơn thành công",style:{width:"28rem"}},{default:r(()=>[t("div",bl,[s(e(P),{onClick:fe,severity:"success",label:e(i)("printOrder"),icon:"pi pi-print",size:"small",class:"min-w-32"},null,8,["label"]),s(e(P),{onClick:he,severity:"info",variant:"outlined",label:"Về trang chủ",icon:"pi pi-home",size:"small",class:"min-w-32"}),s(e(P),{onClick:Ce,severity:"secondary",variant:"outlined",label:"Tạo đơn mới",icon:"pi pi-plus",size:"small",class:"min-w-32"})])]),_:1},8,["visible"])],64))}},Ul=be(yl,[["__scopeId","data-v-f9645ff9"]]),Al={class:"text-sm text-color"},Sl={class:"flex items-end justify-between"},Hl={class:"flex items-center gap-1"},Ll={class:"font-italic text-primary underline select-none"},wl={class:"flex items-center justify-end gap-4"},zl={class:"flex items-center gap-1"},Ml={class:"font-semibold text-color text-sm"},kl={class:"flex items-center gap-2"},$l={class:"flex flex-col gap-2 py-2"},Yl={class:"flex items-center gap-8"},Gl={class:"text-sm font-semibold text-color"},Wl={class:"text-sm font-semibold text-color"},Fl={class:"text-sm text-color"},jl={class:"flex items-center justify-between"},Bl={class:"flex items-center gap-1"},Ql={class:"font-semibold text-color text-sm"},Jl={class:"flex items-center gap-2"},ql={class:"mb-2"},Kl={class:"text-xs text-orange-600"},Zl={class:"text-xs text-color"},Xl={key:1,class:"text-xs text-color"},es={class:"text-xs text-color"},ts={class:"text-xs text-color"},ls={__name:"BatchOrderCreate",setup(I){const{t:i}=Oe(),O=Pe(),b=Ve(),F=p(b.userAddress),_=p(F.value[0]),x=ne(()=>_.value.addressName),z=ne(()=>_.value.addressPhone),h=p([]),R=p([]),C=p([]),k=p(!1),y=p([]),H=p(!1),T={"Tên người nhận (*)":"RECEIVER_FULLNAME","Số ĐT người nhận (*)":"RECEIVER_PHONE","Địa chỉ nhận (*)":"RECEIVER_ADDRESS","Tên hàng hóa (*)":"PRODUCT_NAME","Số lượng":"PRODUCT_QUANTITY","Trọng lượng (gram)  (*)":"PRODUCT_WEIGHT","Dài (cm)":"PRODUCT_LENGTH","Rộng (cm)":"PRODUCT_WIDTH","Cao (cm)":"PRODUCT_HEIGHT","Giá trị hàng (VND) (*)":"PRODUCT_PRICE","Tiền thu hộ COD (VND)":"MONEY_COLLECTION","Loại hàng hóa (*)":"PRODUCT_TYPE","Người trả cước":"PAYMENT_OBJECT","Yêu cầu khác":"ORDER_NOTE"},oe={RECEIVER_FULLNAME:"min-width: 140px;",RECEIVER_PHONE:"min-width: 150px;",RECEIVER_ADDRESS:"min-width: 320px;",PRODUCT_NAME:"min-width: 220px;",PRODUCT_QUANTITY:"min-width: 80px;",PRODUCT_WEIGHT:"min-width: 180px;",PRODUCT_PRICE:"min-width: 180px;",MONEY_COLLECTION:"min-width: 180px;",PRODUCT_TYPE:"min-width: 140px;",PAYMENT_OBJECT:"min-width: 140px;",ORDER_NOTE:"min-width: 220px;"},ie=[{name:"Người nhận trả",value:"Người nhận trả"},{name:"Người gửi trả",value:"Người gửi trả"}],L=[{name:"Bưu kiện",value:"Bưu kiện"},{name:"Tài liệu",value:"Tài liệu"}],ee=(u,o)=>{const l=a=>a.replace(/\s+/g," ").trim(),n=new Set(o.map(l));return u.every(a=>n.has(l(a)))},$=p(null),J=p(null),q=p(""),f=p([]),_e=()=>{J.value=null,q.value="",f.value=[],k.value=!1,h.value=[],R.value=[],C.value=[]},me=u=>{_e(),J.value=u.target.files[0],q.value=u.target.files[0].name;const o=new FileReader;o.onload=l=>{const n=new Uint8Array(l.target.result),a=Me(n,{type:"array"}),E=a.SheetNames[0],m=a.Sheets[E];let c=ke.sheet_to_json(m,{defval:""});c=c.map(D=>{const g={...D};return delete g.STT,delete g["Mã đơn hàng "],g}),c=c.map(D=>{const g={};for(const[re,Te]of Object.entries(D))re.includes("EMPTY")||(g[re.trim()]=Te);return g}),c=c.filter(D=>Object.values(D).some(g=>g!==""&&g!==null&&g!==void 0));const te=Object.keys(T),j=Object.keys(c[0]);if(!ee(te,j)){A.error("File template không đúng"),J.value=null,q.value="",f.value=[];return}f.value=c.map(D=>{let g={};return Object.entries(D).map(([re,Te])=>{g[T[re]]=Te}),g}),h.value=new Array(f.value.length).fill(null),R.value=new Array(f.value.length).fill(null),C.value=new Array(f.value.length).fill(null),y.value=new Array(f.value.length).fill(null)},o.readAsArrayBuffer(J.value)},pe=u=>{u.value!==u.newValue&&(f.value[u.index][u.field]=u.newValue,k.value=!1,h.value=new Array(f.value.length).fill(null),R.value=new Array(f.value.length).fill(null),C.value=new Array(f.value.length).fill(null))},Ee=async()=>{h.value=new Array(f.value.length).fill(null),R.value=new Array(f.value.length).fill(null),C.value=new Array(f.value.length).fill(null);const u=f.value.map(n=>{let a={};return a.SENDER_ADDRESS=_.value.address,a.RECEIVER_ADDRESS=n.RECEIVER_ADDRESS,a.PRODUCT_TYPE=n.PRODUCT_TYPE==="Tai lieu"?"TH":"HH",a.PRODUCT_WEIGHT=n.PRODUCT_WEIGHT,a.PRODUCT_PRICE=n.PRODUCT_PRICE,a.MONEY_COLLECTION=n.MONEY_COLLECTION,a.PRODUCT_WIDTH=n.PRODUCT_WIDTH||null,a.PRODUCT_HEIGHT=n.PRODUCT_HEIGHT||null,a.PRODUCT_LENGTH=n.PRODUCT_LENGTH||null,a.TYPE=1,a}),o=10,l=ge(u,o);for(let n=0;n<l.length;n++){const E=l[n].map((c,te)=>{const j=n*o+te;return Q.post("/connector/viettelpost/price-all-nlp",{data:c}).then(D=>({res:D,idx:j})).catch(D=>({err:D,idx:j}))});(await Promise.allSettled(E)).map(c=>{c.status==="fulfilled"&&!c.value.res?.data?.data?.error?(h.value[c.value.idx]=c.value.res.data.data.RESULT,R.value[c.value.idx]=c.value.res.data.data.RESULT[0],C.value[c.value.idx]={status:"success",message:"Đơn hợp lệ"}):C.value[c.value.idx]={status:"error",message:"Đơn không hợp lệ"}})}k.value=!0},ve=(u,o)=>{R.value[u]=h.value[u].find(l=>l.MA_DV_CHINH===o),console.log("Selected service:",R.value[u])},Re=async()=>{const u=f.value.map((n,a)=>{let{PAYMENT_OBJECT:E,...m}=n;return m.SENDER_FULLNAME=x.value,m.SENDER_PHONE=z.value,m.SENDER_ADDRESS=_.value.address,m.PRODUCT_TYPE=n.PRODUCT_TYPE==="Tài liệu"?"TH":"HH",m.ORDER_SERVICE=R.value[a]?.MA_DV_CHINH||null,m.PRODUCT_DETAIL=[],n.MONEY_COLLECTION?n.PAYMENT_OBJECT==="Người nhận trả"?m.ORDER_PAYMENT=2:m.ORDER_PAYMENT=3:n.PAYMENT_OBJECT==="Người nhận trả"?m.ORDER_PAYMENT=4:m.ORDER_PAYMENT=1,m}),o=10,l=ge(u,o);for(let n=0;n<l.length;n++){const E=l[n].map((c,te)=>{const j=n*o+te;return Q.post("/connector/viettelpost/order/create-nlp",{data:c}).then(D=>({res:D,index:j})).catch(D=>({err:D,index:j}))});(await Promise.allSettled(E)).forEach(c=>{c.status==="fulfilled"?c.value.err?C.value[c.value.index]={status:"error",message:"Tạo đơn thất bại"}:c.value.res.data?.success?(C.value[c.value.index]={status:"success",message:"Tạo đơn thành công"},y.value[c.value.index]=c.value.res.data.data):C.value[c.value.index]={status:"error",message:"Tạo đơn thất bại"}:C.value[c.value.index]={status:"error",message:"Tạo đơn thất bại"}})}H.value=!0},fe={VIETTEL_POST:"viettelpost",YUNDA:"yunda"},he=u=>{const o=y.value[u],l=fe[o.carrier],n=o.waybill,a=`/print-order/${l}?ordercode=${n}`,E=O.resolve(a);window.open(E.href,"_blank")},Ce=()=>{const u=document.createElement("a");u.href="/docs/batch-orders.xlsx",u.download="batch-orders.xlsx",document.body.appendChild(u),u.click(),document.body.removeChild(u)};return(u,o)=>(v(),V("div",Al,[t("div",Sl,[t("div",Hl,[o[5]||(o[5]=t("i",{class:"pi pi-file-excel text-primary mb-1"},null,-1)),o[6]||(o[6]=t("span",null,"File: ",-1)),t("span",Ll,d(q.value),1)]),t("div",wl,[t("input",{ref_key:"fileInput",ref:$,type:"file",accept:".xlsx,.xls,.csv",class:"hidden",onChange:me},null,544),s(e(P),{icon:"pi pi-upload",label:e(i)("upload"),size:"small",onClick:o[0]||(o[0]=l=>$.value.click())},null,8,["label"]),s(e(P),{icon:"pi pi-download",variant:"outlined",severity:"info",label:e(i)("downloadTemplate"),size:"small",onClick:Ce},null,8,["label"])])]),s(e(Y),{class:"mt-4"},{title:r(()=>[t("div",zl,[o[7]||(o[7]=t("i",{class:"pi pi-user size-5"},null,-1)),t("span",Ml,d(e(i)("sender")),1)])]),content:r(()=>[t("div",kl,[s(e(Z),null,{default:r(()=>[s(e(X),{class:"pi pi-address-book"}),s(e(w),{size:"small",readonly:"",modelValue:x.value,"onUpdate:modelValue":o[1]||(o[1]=l=>x.value=l)},null,8,["modelValue"])]),_:1}),s(e(Z),null,{default:r(()=>[s(e(X),{class:"pi pi-phone"}),s(e(w),{size:"small",readonly:"",modelValue:z.value,"onUpdate:modelValue":o[2]||(o[2]=l=>z.value=l)},null,8,["modelValue"])]),_:1}),s(e(G),{options:F.value,optionLabel:"address",modelValue:_.value,"onUpdate:modelValue":o[3]||(o[3]=l=>_.value=l),size:"small",fluid:"",onChange:o[4]||(o[4]=l=>console.log(_.value))},{option:r(l=>[t("div",$l,[t("div",Yl,[t("span",Gl,[o[8]||(o[8]=t("i",{class:"pi pi-warehouse size-4 mr-1"},null,-1)),W(d(l.option.addressName),1)]),t("span",Wl,[o[9]||(o[9]=t("i",{class:"pi pi-phone size-4 mr-1"},null,-1)),W(d(l.option.addressPhone),1)])]),t("span",Fl,[o[10]||(o[10]=t("i",{class:"pi pi-map-marker size-4 mr-1"},null,-1)),W(d(l.option.address),1)])])]),_:1},8,["options","modelValue"])])]),_:1}),f.value.length?(v(),U(e(Y),{key:0,class:"mt-4"},{title:r(()=>[t("div",jl,[t("div",Bl,[o[11]||(o[11]=t("i",{class:"pi pi-list size-5 mt-1"},null,-1)),t("span",Ql,d(e(i)("orderList")),1)]),t("div",Jl,[s(e(P),{icon:"pi pi-check",variant:"outlined",severity:"info",label:e(i)("confirm"),size:"small",onClick:Ee},null,8,["label"]),k.value?(v(),U(e(P),{key:0,onClick:Re,icon:"pi pi-file-plus",size:"small",label:e(i)("createOrder")},null,8,["label"])):B("",!0)])])]),content:r(()=>[t("div",ql,[t("span",Kl,d(e(i)("orderListExcelChangedHint")),1)]),s(e(We),{value:f.value,editMode:"cell",onCellEditComplete:pe,showGridlines:"",scrollable:"",scrollHeight:"flex",size:"small"},{default:r(()=>[s(e(K),{frozen:"",alignFrozen:"left",field:"STT",header:"STT",style:{"min-width":"50px"},class:"frozen-column-emerald"},{body:r(l=>[t("div",Zl,d(l.index),1)]),_:1}),H.value?(v(),U(e(K),{key:0,frozen:"",alignFrozen:"left",header:e(i)("printOrder"),style:{"min-width":"64px"},class:"frozen-column-emerald"},{body:r(l=>[y.value[l.index]?(v(),U(e(P),{key:0,icon:"pi pi-print",size:"small",onClick:n=>he(l.index)},null,8,["onClick"])):B("",!0)]),_:1},8,["header"])):B("",!0),s(e(K),{frozen:"",alignFrozen:"left",field:"Trạng thái",header:e(i)("status"),style:{"min-width":"120px"},class:"frozen-column-emerald"},{body:r(l=>[k.value?(v(),V("div",{key:0,class:Le(["text-xs text-color",[C.value[l.index]?.status==="success"?"text-primary-600":"text-red-600"]])},d(C.value[l.index].message),3)):(v(),V("div",Xl,"Chưa xác nhận"))]),_:1},8,["header"]),H.value?B("",!0):(v(),U(e(K),{key:1,frozen:"",alignFrozen:"left",field:"Dịch vụ",header:e(i)("service"),style:{"min-width":"250px","font-size":"12px"},class:"frozen-column-emerald"},{body:r(l=>[t("span",null,d(R.value[l.index]?`${R.value[l.index].MA_DV_CHINH} - ${R.value[l.index].TEN_DICHVU}`:""),1)]),editor:r(({data:l,field:n,index:a})=>[s(e(G),{options:h.value[a],optionValue:"MA_DV_CHINH",optionLabel:"TEN_DICHVU",placeholder:"Chọn dịch vụ",size:"small",fluid:"","onUpdate:modelValue":E=>ve(a,E)},null,8,["options","onUpdate:modelValue"])]),_:1},8,["header"])),H.value?B("",!0):(v(),U(e(K),{key:2,frozen:"",alignFrozen:"left",field:"Giá cước",header:e(i)("totalFee"),style:{"min-width":"100px"},class:"frozen-column-emerald"},{body:r(l=>[t("div",es,d(R.value[l.index]?e(ae)(R.value[l.index].GIA_CUOC):""),1)]),_:1},8,["header"])),(v(!0),V(ce,null,De(Object.entries(T),l=>(v(),U(e(K),{key:l[0],field:l[1],header:e(i)(l[1]),style:we(oe[l[1]])},{body:r(({data:n,field:a})=>[t("div",ts,d(n[a]),1)]),editor:r(({data:n,field:a})=>[a==="PRODUCT_QUANTITY"||a==="PRODUCT_WEIGHT"||a==="PRODUCT_PRICE"||a==="MONEY_COLLECTION"?(v(),U(e(S),{key:0,modelValue:n[a],"onUpdate:modelValue":E=>n[a]=E,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):a==="PAYMENT_OBJECT"?(v(),U(e(G),{key:1,options:ie,optionLabel:"name",optionValue:"value",modelValue:n[a],"onUpdate:modelValue":E=>n[a]=E,size:"small"},null,8,["modelValue","onUpdate:modelValue"])):a==="PRODUCT_TYPE"?(v(),U(e(G),{key:2,size:"small",options:L,optionLabel:"name",optionValue:"value",modelValue:n[a],"onUpdate:modelValue":E=>n[a]=E},null,8,["modelValue","onUpdate:modelValue"])):(v(),U(e(w),{key:3,modelValue:n[a],"onUpdate:modelValue":E=>n[a]=E,size:"small"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1},8,["field","header","style"]))),128))]),_:1},8,["value"])]),_:1})):B("",!0)]))}},ss={__name:"index",setup(I){const{t:i}=Oe();return(O,b)=>(v(),V("div",null,[s(e(Qe),{value:"1"},{default:r(()=>[s(e(Je),null,{default:r(()=>[s(e(Ne),{value:"1",as:"div",class:"flex items-center gap-1"},{default:r(()=>[b[0]||(b[0]=t("i",{class:"pi pi-file-check"},null,-1)),W(" "+d(e(i)("singleOrder")),1)]),_:1}),s(e(Ne),{value:"2",as:"div",class:"flex items-center gap-1"},{default:r(()=>[b[1]||(b[1]=t("i",{class:"pi pi-list-check"},null,-1)),W(" "+d(e(i)("batchOrder")),1)]),_:1})]),_:1}),s(e(qe),{class:"mt-4"},{default:r(()=>[s(e(Ie),{value:"1"},{default:r(()=>[s(Ul)]),_:1}),s(e(Ie),{value:"2"},{default:r(()=>[s(ls)]),_:1})]),_:1})]),_:1})]))}},gs=be(ss,[["__scopeId","data-v-e95e8dc7"]]);export{gs as default};
